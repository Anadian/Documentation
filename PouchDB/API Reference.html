<!DOCTYPE html>
<html manifest="/manifest.appcache" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>API Reference</title>
    <link rel="alternate" title="PouchDB, the JavaScript Database that Syncs!" type="application/rss+xml" href="https://pouchdb.com/feed.xml">
    <link rel="stylesheet" href="API%20Reference_files/pouchdb.css">
    <meta name="theme-color" content="#6ccb99">
    <meta name="msapplication-TileColor" content="#6ccb99">
    <script src="API%20Reference_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href="API%20Reference_files/css.css" rel="stylesheet" type="text/css">
    <link rel="icon" href="https://pouchdb.com/static/favicon.ico" type="image/x-icon">
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header role="banner">

      <a href="https://github.com/pouchdb/pouchdb" target="_blank" rel="noopener noreferrer">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="https://pouchdb.com/">
          <div class="logo-img"></div>
          <span class="sr-only">PouchDB</span>
        </a>

        <ul class="nav nav-header nav-pills" role="navigation">
          <li>
            <a class="btn btn-link btn-lg" href="https://pouchdb.com/blog/">Blog</a>
          </li>
          <li>
            <a class="btn btn-link btn-lg" href="https://pouchdb.com/guides/">Guides</a>
          </li>
          <li>
            <a class="btn btn-link btn-lg" href="https://pouchdb.com/api.html">API</a>
          </li>
          <li>
            <a class="btn btn-link btn-lg" href="https://pouchdb.com/learn.html">Learn</a>
          </li>
          <li>
            <a class="btn btn-primary btn-lg" href="https://pouchdb.com/download.html">Download <strong>v6.3.4</strong></a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="band band-inverse">

        <div class="container">

          <h1 class="margin-bottom-none">API Reference</h1>
          
          

        </div>

      </div>
    

    <div role="main">
      <article class="band">
  <div class="container">
    <div class="row">
        <div id="sidebar" class="col-sm-3 nav-sidebar-wrapper">
          <ul class="nav nav-silent nav-sidebar" role="navigation">
            <li class="active"><a href="#overview">API overview</a></li>
<li><a href="#create_database">Create database</a></li>
<li><a href="#delete_database">Delete database</a></li>
<li><a href="#create_document">Create/update doc</a></li>
<li class=""><a href="#fetch_document">Fetch doc</a></li>
<li><a href="#delete_document">Delete doc</a></li>
<li><a href="#batch_create">Batch create</a></li>
<li><a href="#batch_fetch">Batch fetch</a></li>
<li><a href="#changes">Changes</a></li>
<li><a href="#replication">Replication</a></li>
<li><a href="#sync">Sync</a></li>
<li><a href="#save_attachment">Save attachment</a></li>
<li><a href="#get_attachment">Get attachment</a></li>
<li><a href="#delete_attachment">Delete attachment</a></li>
<li><a href="#create_index">Create index</a></li>
<li><a href="#query_index">Query index</a></li>
<li><a href="#explain_index">Explain index</a></li>
<li><a href="#list_indexes">List indexes</a></li>
<li><a href="#delete_index">Delete index</a></li>
<li><a href="#query_database">Map/reduce query</a></li>
<li><a href="#view_cleanup">View cleanup</a></li>
<li><a href="#database_information">Database info</a></li>
<li><a href="#compaction">Compaction</a></li>
<li><a href="#revisions_diff">Revision diff</a></li>
<li><a href="#bulk_get">Bulk get</a></li>
<li><a href="#close_database">Close database</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#defaults">Default settings</a></li>
<li><a href="#plugins">Plugins</a></li>
<li><a href="#debug_mode">Debug mode</a></li>

          </ul>
        </div>

        <div class="col-sm-9" role="main">
          
<div class="h2"><div class="anchor-id" id="overview"></div><a class="anchor" href="#overview" name="overview">API overview</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/overview.html" target="_blank"></a></div>

<p>PouchDB has an asynchronous API, supporting <a href="http://docs.nodejitsu.com/articles/getting-started/control-flow/what-are-callbacks">callbacks</a>, <a href="https://www.promisejs.org/">promises</a>, and
<a href="https://jakearchibald.com/2014/es7-async-functions/">async functions</a>.
 For beginners, we recommend promises, although you are free to use 
whatever format you prefer. If you are unsure, check out our <a href="https://pouchdb.com/guides/async-code.html">guide to asynchronous code</a>.</p>

<p>Most of the API is exposed as:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">doSomething</span><span class="p">(</span><span class="nx">args</span><span class="p">...,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>… where both the <code>options</code> and <code>callback</code> are optional.</p>

<h3 id="callbacks">Callbacks</h3>

<p>Callbacks use the standard Node.js idiom of:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span></code></pre></figure>

<p>… where the <code>error</code> will be undefined if there’s no error.</p>

<h3 id="promises">Promises</h3>

<p>If you don’t specify a <code>callback</code>, then the API returns a <a href="https://www.promisejs.org/">promise</a>. In <a href="http://caniuse.com/#feat=promises">supported browsers</a> or Node.js, native promises are used, falling back to the minimal library <a href="https://github.com/calvinmetcalf/lie">lie</a> as needed.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>Using Ionic/AngularJS?</strong>  You can wrap PouchDB promises in <a href="https://docs.angularjs.org/api/ng/service/$q#when"><code>$q.when()</code></a>. This will notify AngularJS to update the UI when the PouchDB promise has resolved.</p>


</div></div>

<p>To use a custom promise implementation with PouchDB, you must redefine a global <code>Promise</code> object before loading PouchDB:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">Promise</span> <span class="o">=</span> <span class="nx">MyCustomPromiseLibrary</span><span class="p">;</span><span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"path/to/pouchdb.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h3 id="async-functions">Async functions</h3>

<p>If you are using a transpiler like <a href="http://babeljs.io/">Babel</a>, you can enable <a href="https://github.com/tc39/ecmascript-asyncawait">async functions</a>, which are an experimental API tentatively slated for release in ES7 (ES2016). This allows you to use the <code>async</code>/<code>await</code> keywords when consuming promise-based APIs like PouchDB’s.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>How to configure Babel?</strong> To use async functions, you will need the <a href="http://babeljs.io/docs/plugins/syntax-async-functions/">syntax-async-functions plugin</a>, as well as the <a href="https://babeljs.io/docs/plugins/transform-regenerator/">transform-regenerator plugin</a> or <a href="https://github.com/marten-de-vries/kneden">Kneden</a> (which is experimental as of this writing). For a full working example, see <a href="https://github.com/nolanlawson/async-functions-with-regenerator">async-functions-with-regenerator</a>.</p>


</div></div>

<p>Note that the samples for <code>async</code>/<code>await</code> in the API documentation assume that your code is inside an async function. So for instance:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">async</span> <span class="kd">function</span> <span class="nx">myFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// your code goes in here</span>
<span class="p">}</span></code></pre></figure>

<p>Any <code>await</code> not inside of an async function is a syntax error. For more information about <code>async</code>/<code>await</code>, read <a href="http://pouchdb.com/2015/03/05/taming-the-async-beast-with-es7.html">our introductory blog post</a>.</p>

<div class="h2"><div class="anchor-id" id="create_database"></div><a class="anchor" href="#create_database" name="create_database">Create a database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/create_database.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">new</span> <span class="nx">PouchDB</span><span class="p">([</span><span class="nx">name</span><span class="p">],</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></figure>

<p>This method creates a database or opens an existing one. If you use a URL like <code>'http://domain.com/dbname'</code>, then PouchDB will work as a client to an online CouchDB instance.  Otherwise it will create a local database using <a href="https://pouchdb.com/adapters.html">whatever backend is present</a>.</p>

<h3 id="options">Options</h3>

<ul>
  <li><code>name</code>: You can omit the <code>name</code> argument and specify it via <code>options</code> instead. Note that the name is required.</li>
</ul>

<p><strong>Options for local databases:</strong></p>

<ul>
  <li><code>auto_compaction</code>: This turns on auto compaction, which means <code>compact()</code> is called after every change to the database. Defaults to <code>false</code>.</li>
  <li><code>adapter</code>: One of <code>'idb'</code>, <code>'leveldb'</code>, <code>'websql'</code>, or <code>'http'</code>.
 If unspecified, PouchDB will infer this automatically, preferring 
IndexedDB to WebSQL in browsers that support both (i.e. Chrome, Opera 
and Android 4.4+).</li>
  <li><code>revs_limit</code>: Specify how many old revisions we keep 
track (not a copy) of. Specifying a low value means Pouch may not be 
able to figure out whether a new revision received via replication is 
related to any it currently has which could result in a conflict. 
Defaults to <code>1000</code>.</li>
</ul>

<p><strong>Options for remote databases:</strong></p>

<ul>
  <li><code>ajax</code>: (Remote databases only.) Ajax requester options. For instance, passing in the options <code>{ajax: {timeout: 10000}}</code> will allow you to set the max timeout for an HTTP request. These are passed verbatim to <a href="https://github.com/mikeal/request">request</a> (in Node.js) or  <a href="https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-ajax/src/request-browser.js">a request shim</a> (in the browser), with the exception of:</li>
  <li><code>ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
  <li><code>ajax.headers</code>: The <code>ajax.headers</code> option allows you to customise headers that are sent to the remote HTTP Server.</li>
  <li><code>auth.username</code> + <code>auth.password</code>: You can specify HTTP auth parameters either by using a database with a name in the form <code>http://user:pass@host/name</code> or via the <code>auth.username</code> + <code>auth.password</code> options.</li>
  <li><code>ajax.withCredentials</code>: Set to <code>false</code> to disable transferring cookies or <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Requests_with_credentials">HTTP Auth information</a>. Defaults to <code>true</code>.</li>
  <li><code>skip_setup</code>: Initially PouchDB checks if the database exists, and tries to create it, if it does not exist yet. Set this to <code>true</code> to skip this setup.</li>
</ul>

<p><strong>IndexedDB-only options:</strong></p>

<ul>
  <li><code>storage</code>: Specifies whether you want to use <code>persistent</code> or <code>temporary</code>
 storage. This non-standard feature has been supported in Firefox since 
version 26. Find out more about the available storage types, and how 
Firefox handles client-side data storage, at <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria">Browser storage limits and eviction criteria</a>.</li>
</ul>

<p><strong>WebSQL-only options:</strong></p>

<ul>
  <li><code>size</code>: Amount in MB to request for storage, which you will need if you are storing &gt;5MB in order to <a href="https://pouchdb.com/errors.html#not_enough_space">avoid storage limit errors on iOS/Safari</a>.
 Persistent views use a separate database per view which will also 
request storage space so keep in mind the upper storage limits when 
using persistent views on iOS.</li>
</ul>

<p><strong>Notes:</strong></p>

<ol>
  <li>In IndexedDB and WebSQL, PouchDB will use <code>_pouch_</code> to prefix the internal database names. Do not manually create databases with the same prefix.</li>
  <li>When acting as a client on Node, any other options given will be passed to <a href="https://github.com/mikeal/request">request</a>.</li>
  <li>When using the <code>'leveldb'</code> adapter (the default on Node), any other options given will be passed to <a href="https://github.com/rvagg/node-levelup">levelup</a>.</li>
</ol>

<h4 id="example-usage">Example Usage:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'http://localhost:5984/dbname'</span><span class="p">);</span></code></pre></figure>

<p>Create a PouchDB that explicitly uses WebSQL:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">,</span> <span class="p">{</span><span class="na">adapter</span> <span class="p">:</span> <span class="s1">'websql'</span><span class="p">});</span></code></pre></figure>

<p>Create an in-memory Pouch (must install <code>pouchdb-adapter-memory</code> first):</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">,</span> <span class="p">{</span><span class="na">adapter</span><span class="p">:</span> <span class="s1">'memory'</span><span class="p">});</span></code></pre></figure>

<p>Create a remote PouchDB with special Ajax options:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'http://example.com/dbname'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">ajax</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">cache</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">timeout</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'X-Some-Special-Header'</span><span class="p">:</span> <span class="s1">'foo'</span>
    <span class="p">},</span>
  <span class="p">},</span>
  <span class="na">auth</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">username</span><span class="p">:</span> <span class="s1">'mysecretusername'</span><span class="p">,</span>
    <span class="na">password</span><span class="p">:</span> <span class="s1">'mysecretpassword'</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>For more info, check out <a href="https://pouchdb.com/adapters.html">adapters</a>.</p>

<div class="h2"><div class="anchor-id" id="delete_database"></div><a class="anchor" href="#delete_database" name="delete_database">Delete a database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/delete_database.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Delete the database. Note that this has no impact on other replicated databases.</p>

<h3 id="options-1">Options</h3>

<ul>
  <li><code>options.ajax</code>: (Remote databases only.) Ajax requester options, <a href="#create_database">as described above</a>.</li>
</ul>

<h4 id="example-usage-1">Example Usage</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="destroy_db"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="destroy_db" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// success</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="destroy_db" data-code-type="async" role="complementary">


<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="destroy_db" data-code-type="promise" role="complementary">


<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// success</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span> <span class="err">:</span> <span class="kc">true</span>
<span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="create_document"></div><a class="anchor" href="#create_document" name="create_document">Create/update a document</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/create_document.html" target="_blank"></a></div>

<h3 id="using-dbput">Using db.put()</h3>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Create a new document or update an existing document. If the document already exists, you must specify its revision <code>_rev</code>, otherwise a conflict will occur.</p>

<p>If you want to update an existing document even if there’s conflict, you should specify the base revision <code>_rev</code> and use <code>force=true</code> option, then a new conflict revision will be created.</p>

<p>There are some <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Special_Fields">restrictions on valid property names of the documents</a>. If you try to store non-JSON data (for instance <code>Date</code> objects) you may see <a href="http://pouchdb.com/errors.html#could_not_be_cloned">inconsistent results</a>.</p>

<h4 id="example-usage-2">Example Usage:</h4>

<p>Create a new doc with an <code>_id</code> of <code>'mydoc'</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="newDoc"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="newDoc" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Heroes'</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle response</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="newDoc" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Heroes'</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="newDoc" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Heroes'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>You can update an existing doc using <code>_rev</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="updateDoc"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="updateDoc" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
    <span class="na">_rev</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="na">title</span><span class="p">:</span> <span class="s2">"Let's Dance"</span>
  <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="updateDoc" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
    <span class="na">_rev</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="na">title</span><span class="p">:</span> <span class="s2">"Let's Dance"</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="updateDoc" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="na">_id</span><span class="p">:</span> <span class="s1">'mydoc'</span><span class="p">,</span>
    <span class="na">_rev</span><span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="na">title</span><span class="p">:</span> <span class="s2">"Let's Dance"</span>
  <span class="p">});</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-1">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
  <span class="s2">"rev"</span><span class="err">:</span> <span class="s2">"1-A6157A5EA545C99B00FF904EEF05FD9F"</span>
<span class="p">}</span></code></pre></figure>

<p>The response contains the <code>id</code> of the document, the new <code>rev</code>, and an <code>ok</code> to reassure
you that everything is okay.</p>

<h3 id="using-dbpost">Using db.post()</h3>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Create a new document and let PouchDB auto-generate an <code>_id</code> for it.</p>

<h4 id="example-usage-3">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="post_doc"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="post_doc" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Ziggy Stardust'</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle response</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="post_doc" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
    <span class="na">title</span><span class="p">:</span> <span class="s1">'Ziggy Stardust'</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="post_doc" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'Ziggy Stardust'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle response</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-2">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span> <span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"id"</span> <span class="err">:</span> <span class="s2">"8A2C3761-FFD5-4770-9B8C-38C33CED300A"</span><span class="p">,</span>
  <span class="s2">"rev"</span> <span class="err">:</span> <span class="s2">"1-d3a8e0e5aa7c8fff0c376dac2d8a4007"</span>
<span class="p">}</span></code></pre></figure>

<p><strong>Put vs. post</strong>: The basic rule of thumb is: <code>put()</code> new documents with an <code>_id</code>, <code>post()</code> new documents without an <code>_id</code>.</p>

<p>You should also prefer <code>put()</code> to <code>post()</code>, because when you <code>post()</code>, you are missing an opportunity to use <code>allDocs()</code> to sort documents by <code>_id</code> (because your <code>_id</code>s are random). For more info, read the <a href="https://pouchdb.com/2014/06/17/12-pro-tips-for-better-code-with-pouchdb.html">PouchDB pro tips</a>.</p>

<div class="h2"><div class="anchor-id" id="fetch_document"></div><a class="anchor" href="#fetch_document" name="fetch_document">Fetch a document</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/fetch_document.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Retrieves a document, specified by <code>docId</code>.</p>

<h3 id="options-2">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.rev</code>: Fetch specific revision of a document. Defaults to winning revision (see <a href="http://guide.couchdb.org/draft/conflicts.html">the CouchDB guide</a>).</li>
  <li><code>options.revs</code>: Include revision history of the document.</li>
  <li><code>options.revs_info</code>: Include a list of revisions of the document, and their availability.</li>
  <li><code>options.open_revs</code>: Fetch all leaf revisions if <code>open_revs="all"</code> or fetch all leaf revisions specified in <code>open_revs</code> array. Leaves will be returned in the same order as specified in input array.</li>
  <li><code>options.conflicts</code>: If specified, conflicting leaf revisions will be attached in <code>_conflicts</code> array.</li>
  <li><code>options.attachments</code>: Include attachment data.
    <ul>
      <li><code>options.binary</code>: Return attachment data as Blobs/Buffers, instead of as base64-encoded strings.</li>
    </ul>
  </li>
  <li><code>options.ajax</code>: An object of options to be sent to the ajax requester. In Node they are sent verbatim to <a href="https://github.com/mikeal/request">request</a> with the exception of:</li>
  <li><code>options.ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
  <li><code>options.latest</code>: Forces retrieving latest “leaf” revision, no matter what rev was requested. Default is <code>false</code>.</li>
</ul>

<h4 id="example-usage-4">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="get1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="get1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle doc</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="get1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="get1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle doc</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-3">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
  <span class="s2">"_rev"</span><span class="err">:</span> <span class="s2">"1-A6157A5EA545C99B00FF904EEF05FD9F"</span>
  <span class="s2">"title"</span><span class="err">:</span> <span class="s2">"Rock and Roll Heart"</span><span class="p">,</span>
<span class="p">}</span></code></pre></figure>

<p>The response contains the document as it is stored in the database, along with its
<code>_id</code> and <code>_rev</code>.</p>

<div class="h2"><div class="anchor-id" id="delete_document"></div><a class="anchor" href="#delete_document" name="delete_document">Delete a document</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/delete_document.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Or:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">docRev</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Deletes the document. <code>doc</code> is required to be a document with at least an <code>_id</code> and a <code>_rev</code> property. Sending the full document will work as well.</p>

<p>See <a href="http://pouchdb.com/api.html#filtered-replication">filtered replication</a> for why you might want to use <code>put()</code> with <code>{_deleted: true}</code> instead.</p>

<h4 id="example-usage-5">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_doc"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_doc" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_doc" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_doc" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-4">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
  <span class="s2">"rev"</span><span class="err">:</span> <span class="s2">"2-9AF304BE281790604D1D8A4B0F4C9ADB"</span>
<span class="p">}</span></code></pre></figure>

<p>You can also delete a document by just providing an <code>id</code> and <code>rev</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_doc3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_doc3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_doc3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_doc3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>You can also delete a document by using <code>put()</code> with <code>{_deleted: true}</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_doc2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_doc2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">_deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle response</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_doc2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">);</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">_deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_doc2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'mydoc'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">_deleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<div class="h2"><div class="anchor-id" id="batch_create"></div><a class="anchor" href="#batch_create" name="batch_create">Create/update a batch of documents</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/batch_create.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">(</span><span class="nx">docs</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Create, update or delete multiple documents. The <code>docs</code> argument is an array of documents.</p>

<p>If you omit an <code>_id</code> parameter on a given document, the 
database will create a new document and assign the ID for you. To update
 a document, you must include both an <code>_id</code> parameter and a <code>_rev</code>
 parameter, which should match the ID and revision of the document on 
which to base your updates. Finally, to delete a document, include a <code>_deleted</code> parameter with the value <code>true</code>.</p>

<h4 id="example-usage-6">Example Usage:</h4>

<p>Put some new docs, providing the <code>_id</code>s:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="bulk_docs_1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="bulk_docs_1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc1'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc2'</span><span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="bulk_docs_1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
    <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc1'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc2'</span><span class="p">}</span>
  <span class="p">]);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="bulk_docs_1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc1'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'doc2'</span><span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>Post some new docs and auto-generate the <code>_id</code>s:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="bulk_docs_2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="bulk_docs_2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="bulk_docs_2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
    <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">}</span>
  <span class="p">]);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="bulk_docs_2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">title</span> <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-5">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">"ok"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
    <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"ok"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
    <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></figure>

<p>The response contains an array of the familiar <code>ok</code>/<code>rev</code>/<code>id</code>
from the <a href="#create_document">put()/post() API</a>. If there are any errors, they
will be provided individually like so:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span> <span class="na">status</span><span class="p">:</span> <span class="mi">409</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'conflict'</span><span class="p">,</span>
    <span class="na">message</span><span class="p">:</span> <span class="s1">'Document update conflict'</span><span class="p">,</span>
    <span class="na">error</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></figure>

<p>The results are returned in the same order as the supplied “docs” array.</p>

<p>Note that <code>bulkDocs()</code> is not transactional, and that you may get
back a mixed array of errors/non-errors. In CouchDB/PouchDB, the smallest
atomic unit is the document.</p>

<h4 id="bulk-updatedelete">Bulk update/delete:</h4>

<p>You can also use <code>bulkDocs()</code> to update/delete many documents at once:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="bulk_docs3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="bulk_docs3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">artist</span> <span class="p">:</span> <span class="s1">'Velvet Underground'</span><span class="p">,</span>
    <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
    <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
    <span class="na">artist</span> <span class="p">:</span> <span class="s1">'David Bowie'</span><span class="p">,</span>
    <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
    <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="bulk_docs3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
    <span class="p">{</span>
      <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
      <span class="na">artist</span> <span class="p">:</span> <span class="s1">'Velvet Underground'</span><span class="p">,</span>
      <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
      <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
      <span class="na">artist</span> <span class="p">:</span> <span class="s1">'David Bowie'</span><span class="p">,</span>
      <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
      <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
    <span class="p">}</span>
  <span class="p">]);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="bulk_docs3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">artist</span> <span class="p">:</span> <span class="s1">'Velvet Underground'</span><span class="p">,</span>
    <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
    <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">title</span>  <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
    <span class="na">artist</span> <span class="p">:</span> <span class="s1">'David Bowie'</span><span class="p">,</span>
    <span class="na">_id</span>    <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
    <span class="na">_rev</span>   <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
  <span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>Or delete them:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="bulk_docs_4"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="bulk_docs_4" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
    <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
    <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
    <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="bulk_docs_4" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
    <span class="p">{</span>
      <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
      <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
      <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
      <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
      <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
    <span class="p">}</span>
  <span class="p">]);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="bulk_docs_4" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
    <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-84abc2a942007bee7cf55007cba56198"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">title</span>    <span class="p">:</span> <span class="s1">'Space Oddity'</span><span class="p">,</span>
    <span class="na">_deleted</span> <span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">_id</span>      <span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
    <span class="na">_rev</span>     <span class="p">:</span> <span class="s2">"1-7b80fc50b6af7a905f368670429a757e"</span>
  <span class="p">}</span>
<span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p><strong>Note:</strong> You can also specify a <code>new_edits</code> property on the options object that when set to <code>false</code> allows you to post <a href="http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Posting_Existing_Revisions">existing documents from other databases</a>. This will not allow you to edit existing local documents and normally only the replication algorithm needs to do this.</p>

<div class="h2"><div class="anchor-id" id="batch_fetch"></div><a class="anchor" href="#batch_fetch" name="batch_fetch">Fetch a batch of documents</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/batch_fetch.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Fetch multiple documents, indexed and sorted by the <code>_id</code>.  Deleted documents are only included if <code>options.keys</code> is specified.</p>

<h3 id="options-3">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.include_docs</code>: Include the document itself in each row in the <code>doc</code> field. Otherwise by default you only get the <code>_id</code> and <code>_rev</code> properties.
    <ul>
      <li><code>options.conflicts</code>: Include conflict information in the <code>_conflicts</code> field of a doc.</li>
      <li><code>options.attachments</code>: Include attachment data as base64-encoded string.
        <ul>
          <li><code>options.binary</code>: Return attachment data as Blobs/Buffers, instead of as base64-encoded strings.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get documents with IDs in a certain range (inclusive/inclusive).</li>
  <li><code>options.inclusive_end</code>: Include documents having an ID equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
  <li><code>options.limit</code>: Maximum number of documents to return.</li>
  <li><code>options.skip</code>: Number of docs to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
  <li><code>options.descending</code>: Reverse the order of the output documents. Note that the order of <code>startkey</code> and <code>endkey</code> is reversed when <code>descending</code>:<code>true</code>.</li>
  <li><code>options.key</code>: Only return documents with IDs matching this string key.</li>
  <li><code>options.keys</code>: Array of string keys to fetch in a single shot.
    <ul>
      <li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
      <li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
      <li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>"deleted":true</code> in the <code>value</code> property.</li>
      <li>The row for a nonexistent document will just contain an <code>"error"</code> property with the value <code>"not_found"</code>.</li>
      <li>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</li>
    </ul>
  </li>
</ul>

<p><strong>Notes:</strong> For pagination, <code>options.limit</code> and <code>options.skip</code> are also available, but the same performance concerns as in CouchDB apply. Use the <a href="http://docs.couchdb.org/en/latest/couchapp/views/pagination.html">startkey/endkey pattern</a> instead.</p>

<h4 id="example-usage-7">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="all_docs"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="all_docs" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="all_docs" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="all_docs" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-6">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"offset"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"total_rows"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"rows"</span><span class="err">:</span> <span class="p">[{</span>
    <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"0B3358C1-BA4B-4186-8795-9024203EB7DD"</span><span class="p">,</span>
      <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-5782E71F1E4BF698FA3793D9D5A96393"</span><span class="p">,</span>
      <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Sound and Vision"</span><span class="p">,</span>
      <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
      	<span class="s2">"attachment/its-id"</span><span class="p">:</span> <span class="p">{</span>
      	  <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"image/jpg"</span><span class="p">,</span>
      	  <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"R0lGODlhAQABAIAAAP7//wAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="</span><span class="p">,</span>
      	  <span class="s2">"digest"</span><span class="p">:</span> <span class="s2">"md5-57e396baedfe1a034590339082b9abce"</span>
      	<span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
   <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"0B3358C1-BA4B-4186-8795-9024203EB7DD"</span><span class="p">,</span>
   <span class="s2">"key"</span><span class="err">:</span> <span class="s2">"0B3358C1-BA4B-4186-8795-9024203EB7DD"</span><span class="p">,</span>
   <span class="s2">"value"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"rev"</span><span class="err">:</span> <span class="s2">"1-5782E71F1E4BF698FA3793D9D5A96393"</span>
   <span class="p">}</span>
 <span class="p">}]</span>
<span class="p">}</span></code></pre></figure>

<p>In the response, you have three things:</p>

<ul>
  <li><code>total_rows</code> the total number of non-deleted documents in the database</li>
  <li><code>offset</code> the <code>skip</code> if provided, or in CouchDB the actual offset</li>
  <li><code>rows</code>: rows containing the documents, or just the <code>_id</code>/<code>_revs</code> if you didn’t set <code>include_docs</code> to <code>true</code>.</li>
</ul>

<p>You can use <code>startkey</code>/<code>endkey</code> to find all docs in a range:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="all_docs_2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="all_docs_2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">startkey</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">,</span>
  <span class="na">endkey</span><span class="p">:</span> <span class="s1">'quux'</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="all_docs_2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">startkey</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">,</span>
    <span class="na">endkey</span><span class="p">:</span> <span class="s1">'quux'</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="all_docs_2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">startkey</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">,</span>
  <span class="na">endkey</span><span class="p">:</span> <span class="s1">'quux'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>This will return all docs with <code>_id</code>s between <code>'bar'</code> and <code>'quux'</code>.</p>

<h4 id="prefix-search">Prefix search</h4>

<p>You can do prefix search in <code>allDocs()</code> – i.e. “give me all the documents whose <code>_id</code>s start with <code>'foo'</code>” – by using the special high Unicode character <code>'\ufff0'</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="all_docs_3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="all_docs_3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">startkey</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="na">endkey</span><span class="p">:</span> <span class="s1">'foo\ufff0'</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="all_docs_3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="na">startkey</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
    <span class="na">endkey</span><span class="p">:</span> <span class="s1">'foo\ufff0'</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="all_docs_3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">attachments</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">startkey</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="na">endkey</span><span class="p">:</span> <span class="s1">'foo\ufff0'</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>This works because CouchDB/PouchDB <code>_id</code>s are sorted <a href="http://docs.couchdb.org/en/latest/couchapp/views/collation.html">lexicographically</a>.</p>

<div class="h2"><div class="anchor-id" id="changes"></div><a class="anchor" href="#changes" name="changes">Listen to database changes</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/changes.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></code></pre></figure>

<p>A list of changes made to documents in the database, in the order they were made.
It returns an object with the method <code>cancel()</code>, which you call if you don’t want to listen to new changes anymore.</p>

<p>It is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>'change'</code> event on each document change, a <code>'complete'</code> event when all the changes have been processed, and an <code>'error'</code> event when an error occurs. Calling <code>cancel()</code> will unsubscribe all event listeners automatically.</p>

<h3 id="options-4">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.live</code>: Will emit change events for all future changes until cancelled.</li>
  <li><code>options.include_docs</code>: Include the associated document with each change.
    <ul>
      <li><code>options.conflicts</code>: Include conflicts.</li>
      <li><code>options.attachments</code>: Include attachments.
        <ul>
          <li><code>options.binary</code>: Return attachment data as Blobs/Buffers, instead of as base64-encoded strings.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code>options.descending</code>: Reverse the order of the output documents.</li>
  <li><code>options.since</code>: Start the results from the change immediately after the given sequence number. You can also pass <code>'now'</code> if you want only new changes (when <code>live</code> is <code>true</code>).</li>
  <li><code>options.limit</code>: Limit the number of results to this number.</li>
  <li><code>options.timeout</code>: Request timeout (in milliseconds), use <code>false</code> to disable.</li>
  <li><code>options.heartbeat</code>: For http adapter only, time in 
milliseconds for server to give a heartbeat to keep long connections 
open. Defaults to 10000 (10 seconds), use <code>false</code> to disable the default.</li>
</ul>

<p><strong>Filtering Options:</strong></p>

<ul>
  <li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates. To use a view function, pass <code>_view</code> here and provide a reference to the view function in <code>options.view</code>. See <a href="#filtered-changes">filtered changes</a> for details.</li>
  <li><code>options.doc_ids</code>: Only show changes for docs with these ids (array of strings).</li>
  <li><code>options.query_params</code>: Object containing properties that are passed to the filter function, e.g. <code>{"foo:"bar"}</code>, where <code>"bar"</code> will be available in the filter function as <code>params.query.foo</code>. To access the <code>params</code>, define your filter function like <code>function (doc, params) {/* ... */}</code>.</li>
  <li><code>options.view</code>: Specify a view function (e.g. <code>'design_doc_name/view_name'</code> or <code>'view_name'</code> as shorthand for <code>'view_name/view_name'</code>) to act as a filter. Documents counted as “passed” for a view filter if a map function emits at least one record for them. <strong>Note</strong>: <code>options.filter</code> must be set to <code>'_view'</code> for this option to work.</li>
  <li><code>options.selector</code>: Filter using a query/pouchdb-find <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#selector-syntax">selector</a>. <strong>Note</strong>: Selectors are not supported in CouchDB 1.x. Cannot be used in combination with the filter option.</li>
</ul>

<p><strong>Advanced Options:</strong></p>

<ul>
  <li><code>options.return_docs</code> (previously <code>options.returnDocs</code>): Is available for non-http databases and defaults to <code>true</code>. Passing <code>false</code>
 prevents the changes feed from keeping all the documents in memory – in
 other words complete always has an empty results array, and the <code>change</code> event is the only way to get the event. Useful for large change sets where otherwise you would run out of memory.</li>
  <li><code>options.batch_size</code>: Only available for http 
databases, this configures how many changes to fetch at a time. 
Increasing this can reduce the number of requests made. Default is 25.</li>
  <li><code>options.style</code>: Specifies how many revisions are returned in the changes array. The default, <code>'main_only'</code>, will only return the current “winning” revision; <code>'all_docs'</code>
 will return all leaf revisions (including conflicts and deleted former 
conflicts). Most likely you won’t need this unless you’re writing a 
replicator.</li>
</ul>

<h4 id="example-usage-8">Example Usage:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">since</span><span class="p">:</span> <span class="s1">'now'</span><span class="p">,</span>
  <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">change</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// changes() was canceled</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">changes</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></figure>

<h4 id="example-response-7">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"id"</span><span class="err">:</span><span class="s2">"somestuff"</span><span class="p">,</span>
  <span class="s2">"seq"</span><span class="err">:</span><span class="mi">21</span><span class="p">,</span>
  <span class="s2">"changes"</span><span class="err">:</span><span class="p">[{</span>
    <span class="s2">"rev"</span><span class="p">:</span><span class="s2">"1-8e6e4c0beac3ec54b27d1df75c7183a8"</span>
  <span class="p">}],</span>
  <span class="s2">"doc"</span><span class="err">:</span><span class="p">{</span>
    <span class="s2">"title"</span><span class="err">:</span><span class="s2">"Ch-Ch-Ch-Ch-Changes"</span><span class="p">,</span>
    <span class="s2">"_id"</span><span class="err">:</span><span class="s2">"someDocId"</span><span class="p">,</span>
    <span class="s2">"_rev"</span><span class="err">:</span><span class="s2">"1-8e6e4c0beac3ec54b27d1df75c7183a8"</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<h4 id="change-events">Change events</h4>

<ul>
  <li><strong><code>change</code></strong> (<code>info</code>) - This event fires when a change has been found. <code>info</code> will contain details about the change, such as whether it was deleted and what the new <code>_rev</code> is. <code>info.doc</code> will contain the doc if you set <code>include_docs</code> to <code>true</code>. See below for an example response.</li>
  <li><strong><code>complete</code></strong> (<code>info</code>) - This event fires when all changes have been read. In live changes, only cancelling the changes should trigger this event. <code>info.results</code> will contain the list of changes. See below for an example.</li>
  <li><strong><code>error</code></strong> (<code>err</code>) - This event is fired when the changes feed is stopped due to an unrecoverable failure.</li>
</ul>

<h4 id="example-response-8">Example response</h4>

<p>Example response in the <code>'change'</code> listener (using <code>{include_docs: true}</code>):</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="nl">id</span><span class="p">:</span> <span class="s1">'doc1'</span><span class="p">,</span>
  <span class="nx">changes</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">rev</span><span class="p">:</span> <span class="s1">'1-9152679630cc461b9477792d93b83eae'</span> <span class="p">}</span> <span class="p">],</span>
  <span class="nx">doc</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">_id</span><span class="p">:</span> <span class="s1">'doc1'</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="err">:</span> <span class="s1">'1-9152679630cc461b9477792d93b83eae'</span>
  <span class="p">},</span>
  <span class="nx">seq</span><span class="err">:</span> <span class="mi">1</span>
<span class="p">}</span></code></pre></figure>

<p>Example response in the <code>'change'</code> listener when a doc was deleted:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="nl">id</span><span class="p">:</span> <span class="s1">'doc2'</span><span class="p">,</span>
  <span class="nx">changes</span><span class="err">:</span> <span class="p">[</span> <span class="p">{</span> <span class="na">rev</span><span class="p">:</span> <span class="s1">'2-9b50a4b63008378e8d0718a9ad05c7af'</span> <span class="p">}</span> <span class="p">],</span>
  <span class="nx">doc</span><span class="err">:</span> <span class="p">{</span> <span class="nl">_id</span><span class="p">:</span> <span class="s1">'doc2'</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="err">:</span> <span class="s1">'2-9b50a4b63008378e8d0718a9ad05c7af'</span><span class="p">,</span>
    <span class="nx">_deleted</span><span class="err">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="nx">deleted</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="nx">seq</span><span class="err">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></figure>

<p>Example response in the <code>'complete'</code> listener:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"results"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
      <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-9152679630cc461b9477792d93b83eae"</span> <span class="p">}</span> <span class="p">],</span>
      <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc1"</span><span class="p">,</span>
        <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-9152679630cc461b9477792d93b83eae"</span>
      <span class="p">},</span>
      <span class="s2">"seq"</span><span class="err">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
      <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[</span> <span class="p">{</span> <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"2-9b50a4b63008378e8d0718a9ad05c7af"</span> <span class="p">}</span> <span class="p">],</span>
      <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc2"</span><span class="p">,</span>
        <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"2-9b50a4b63008378e8d0718a9ad05c7af"</span><span class="p">,</span>
        <span class="s2">"_deleted"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">},</span>
      <span class="s2">"deleted"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="s2">"seq"</span><span class="err">:</span> <span class="mi">3</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">"last_seq"</span><span class="err">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></figure>

<p><code>seq</code> and <code>last_seq</code> correspond to the overall sequence number of the entire database, and it’s what is passed in when using <code>since</code> (except for the special <code>'now'</code>). It is the primary key for the changes feed, and is also used as a checkpointer by the replication algorithm.</p>

<h4 id="single-shot">Single-shot</h4>

<p>If you don’t specify <code>{live: true}</code>, then you can also use <code>changes()</code> in the standard
callback/promise style, and it will be treated as a single-shot request, which
returns a list of the changes (i.e. what the <code>'complete'</code> event emits):</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="changes1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="changes1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">limit</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="na">since</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="changes1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
    <span class="na">limit</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="na">since</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="changes1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">limit</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="na">since</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-9">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"results"</span><span class="err">:</span> <span class="p">[{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"0B3358C1-BA4B-4186-8795-9024203EB7DD"</span><span class="p">,</span>
    <span class="s2">"seq"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-5782E71F1E4BF698FA3793D9D5A96393"</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
    <span class="s2">"seq"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-A6157A5EA545C99B00FF904EEF05FD9F"</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"otherdoc"</span><span class="p">,</span>
    <span class="s2">"seq"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-3753476B70A49EA4D8C9039E7B04254C"</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"828124B9-3973-4AF3-9DFD-A94CE4544005"</span><span class="p">,</span>
    <span class="s2">"seq"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">"changes"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-A8BC08745E62E58830CA066D99E5F457"</span>
    <span class="p">}]</span>
  <span class="p">}],</span>
  <span class="s2">"last_seq"</span><span class="err">:</span> <span class="mi">4</span>
<span class="p">}</span></code></pre></figure>

<p>When <code>live</code> is <code>false</code>, the returned object is also an event emitter as well as a promise,
and will fire the <code>'complete'</code> event when the results are ready.</p>

<p>Note that this <code>'complete'</code> event only fires when you aren’t doing live changes.</p>

<h4 id="filtered-changes">Filtered changes</h4>

<p>As with <a href="#replication">replicate()</a>, you can filter using:</p>

<ul>
  <li>an ad-hoc <code>filter</code> function</li>
  <li>an array of <code>doc_ids</code></li>
  <li>a <code>filter</code> function inside of a design document</li>
  <li>a <code>filter</code> function inside of a design document, with <code>query_params</code></li>
  <li>a <code>view</code> function inside of a design document</li>
</ul>

<p>If you are running <code>changes()</code> on a remote CouchDB, then 
the first method will run client-side, whereas the last four will filter
 on the server side. Therefore the last four should be preferred, 
especially if the database is large, because you want to send as few 
documents over the wire as possible.</p>

<p>If you are running <code>changes()</code> on a local PouchDB, then 
obviously all five methods will run client-side. There are also no 
performance benefits to using any of the five, so can also just filter 
yourself, in your own <code>on('change')</code> handler. These methods are implemented in PouchDB purely for consistency with CouchDB.</p>

<p>The named functions can either be specified with <code>'designdoc_id/function_name'</code> or (if both design doc id and function name are equal) as <code>'fname'</code> as shorthand for <code>'fname/fname'</code>.</p>

<h4 id="filtering-examples">Filtering examples</h4>

<p>In these examples, we’ll work with some mammals. Let’s imagine our docs are:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Kangaroo'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Koala'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'c'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Platypus'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'monotreme'</span><span class="p">}</span>
<span class="p">]</span></code></pre></figure>

<p>Here are 5 examples using the 5 different systems.</p>

<p><strong>Example 1: Ad-hoc <code>filter</code> function</strong></p>

<p><em>Warning</em>: this runs client-side, if the database is remote.</p>

<p>Filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">filter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 2: Array of <code>doc_ids</code></strong></p>

<p>Filter documents with <code>_id</code>s <code>['a', 'c']</code>.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">doc_ids</span><span class="p">:</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 3: <code>filter</code> function inside of a design document</strong></p>

<p>First <code>put()</code> a design document:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/mydesign'</span><span class="p">,</span>
  <span class="nx">filters</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myfilter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'mydesign/myfilter'</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 4: <code>filter</code> function inside of a design document, with <code>query_params</code></strong></p>

<p>This is the most powerful way to filter, because it allows you to pass in arbitrary options to your filter function.</p>

<p>First <code>put()</code> a design document:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/myfilter'</span><span class="p">,</span>
  <span class="nx">filters</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myfilter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'myfilter'</span><span class="p">,</span>
  <span class="na">query_params</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>Since both the design document and the filter function have the same name, we can shorten the function name to <code>'myfilter'</code>.</p>

<p><strong>Example 5: <code>view</code> function inside of a design document</strong></p>

<p>This doesn’t really offer any advantages compared to the previous two methods, unless you are already using a <code>view</code> for map/reduce queries, and you want to reuse it.</p>

<p>Any documents that <code>emit()</code> anything will be considered to have passed this filter method.</p>

<p>First <code>put()</code> a design document:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/mydesign'</span><span class="p">,</span>
  <span class="nx">views</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myview</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'_view'</span><span class="p">,</span>
  <span class="na">view</span><span class="p">:</span> <span class="s1">'mydesign/myview'</span>
<span class="p">});</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="replication"></div><a class="anchor" href="#replication" name="replication">Replicate a database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/replication.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></figure>

<p>Replicate data from <code>source</code> to <code>target</code>.  Both the <code>source</code> and <code>target</code> can be a PouchDB instance or a string representing a CouchDB database URL or the name of a local PouchDB database. If <code>options.live</code> is <code>true</code>, then this will track future changes and also replicate them automatically. This method returns an object with the method <code>cancel()</code>, which you call if you want to cancel live replication.</p>

<p>Replication is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> like <a href="#changes">changes()</a> and emits the <code>'complete'</code>, <code>'active'</code>, <code>'paused'</code>, <code>'change'</code>, <code>'denied'</code> and <code>'error'</code> events.</p>

<h3 id="options-5">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>options.live</code>: If <code>true</code>, starts subscribing to future changes in the <code>source</code> database and continue replicating them.</li>
  <li><code>options.retry</code>: If <code>true</code> will attempt to 
retry replications in the case of failure (due to being offline), using a
 backoff algorithm that retries at longer and longer intervals until a 
connection is re-established, with a maximum delay of 10 minutes. Only 
applicable if <code>options.live</code> is also <code>true</code>.</li>
</ul>

<p><strong>Filtering Options:</strong></p>

<ul>
  <li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates. To use a view function, pass <code>_view</code> here and provide a reference to the view function in <code>options.view</code>. See <a href="#filtered-replication">filtered replication</a> for details.</li>
  <li><code>options.doc_ids</code>: Only show changes for docs with these ids (array of strings).</li>
  <li><code>options.query_params</code>: Object containing properties that are passed to the filter function, e.g. <code>{"foo":"bar"}</code>, where <code>"bar"</code> will be available in the filter function as <code>params.query.foo</code>. To access the <code>params</code>, define your filter function like <code>function (doc, params) {/* ... */}</code>.</li>
  <li><code>options.view</code>: Specify a view function (e.g. <code>'design_doc_name/view_name'</code> or <code>'view_name'</code> as shorthand for <code>'view_name/view_name'</code>) to act as a filter. Documents counted as “passed” for a view filter if a map function emits at least one record for them. <strong>Note</strong>: <code>options.filter</code> must be set to <code>'_view'</code> for this option to work.</li>
  <li><code>options.selector</code>: Filter using a query/pouchdb-find <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html#selector-syntax">selector</a>. <strong>Note</strong>: Selectors are not supported in CouchDB 1.x.</li>
</ul>

<p><strong>Advanced Options:</strong></p>

<ul>
  <li><code>options.since</code>: Replicate changes after the given sequence number.</li>
  <li><code>options.heartbeat</code>: Configure the heartbeat supported by CouchDB which keeps the change connection alive.</li>
  <li><code>options.timeout</code>: Request timeout (in milliseconds).</li>
  <li><code>options.batch_size</code>: Number of change feed items to 
process at a time. Defaults to 100. This affects the number of docs and 
attachments held in memory and the number sent at a time to the target 
server. You may need to adjust downward if targeting devices with low 
amounts of memory (e.g. phones) or if the documents and/or attachments 
are large in size or if there are many conflicted revisions. If your 
documents are small in size, then increasing this number will probably 
speed replication up.</li>
  <li><code>options.batches_limit</code>: Number of batches to process at a time. Defaults to 10. This (along wtih <code>batch_size</code>) controls how many docs are kept in memory at a time, so the maximum docs in memory at once would equal <code>batch_size</code> × <code>batches_limit</code>.</li>
  <li><code>options.back_off_function</code>: backoff function to be used in <code>retry</code>
 replication. This is a function that takes the current backoff as input
 (or 0 the first time) and returns a new backoff in milliseconds. You 
can use this to tweak when and how replication will try to reconnect to a
 remote database when the user goes offline. Defaults to a function that
 chooses a random backoff between 0 and 2 seconds and doubles every time
 it fails to connect. The default delay will never exceed 10 minutes. 
(See <a href="#customizing-retry-replication">Customizing retry replication</a> below.)</li>
  <li><code>options.checkpoint</code>: Can be used if you want to disable checkpoints on the source, target, or both. Setting this option to <code>false</code> will prevent writing checkpoints on both source and target. Setting it to <code>source</code> will only write checkpoints on the source. Setting it to <code>target</code> will only write checkpoints on the target.</li>
</ul>

<h4 id="example-usage-9">Example Usage:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rep</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">'mydb'</span><span class="p">,</span> <span class="s1">'http://localhost:5984/mydb'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">retry</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'paused'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// replication paused (e.g. replication up to date, user went offline)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'active'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replicate resumed (e.g. new changes replicating, user went back online)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'denied'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// a document failed to replicate (e.g. due to permissions)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle complete</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle error</span>
<span class="p">});</span>

<span class="nx">rep</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></figure>

<p>There are also shorthands for replication given existing PouchDB objects. These behave the same as <code>PouchDB.replicate()</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span>
<span class="c1">// or</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></figure>

<p>The <code>remoteDB</code> can either be a string or a <code>PouchDB</code> object. If you have special ajax options on a remote database, you will want to use <code>PouchDB</code> objects instead of strings, so that the options are used.</p>

<h4 id="replication-events">Replication events</h4>

<ul>
  <li><strong><code>change</code></strong> (<code>info</code>) - This event fires when the replication has written a new document. <code>info</code> will contain details about the change. <code>info.docs</code> will contain the docs involved in that change. See below for an example response.</li>
  <li><strong><code>complete</code></strong> (<code>info</code>) - This 
event fires when replication is completed or cancelled. In a live 
replication, only cancelling the replication should trigger this event. <code>info</code> will contain details about the replication. See below for an example response.</li>
  <li><strong><code>paused</code></strong> (<code>err</code>) - This 
event fires when the replication is paused, either because a live 
replication is waiting for changes, or replication has temporarily 
failed, with <code>err</code>, and is attempting to resume.</li>
  <li><strong><code>active</code></strong> - This event fires when the 
replication starts actively processing changes; e.g. when it recovers 
from an error or new changes are available.</li>
  <li><strong><code>denied</code></strong> (<code>err</code>) - This event fires if a document failed to replicate due to validation or authorization errors.</li>
  <li><strong><code>error</code></strong> (<code>err</code>) - This event is fired when the replication is stopped due to an unrecoverable failure. If <code>retry</code> is <code>false</code>,
 this will also fire when the user goes offline or another network error
 occurs (so you can handle retries yourself, if you want).</li>
</ul>

<h4 id="single-shot-1">Single-shot</h4>

<p>As with <a href="#changes">changes()</a>, you can also omit <code>live</code>, in which case you can use <code>replicate()</code> in the callback/promise style and it will be treated as a single-shot operation.</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="replication1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="replication1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle 'completed' result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="replication1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="replication1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle 'completed' result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>For non-live replications, the returned object is also an event 
emitter as well as a promise, and you can use all the events described 
above (except for <code>'paused'</code> and <code>'active'</code>, which only apply to <code>retry</code> replications).</p>

<h4 id="example-response-10">Example Response:</h4>

<p>Example response in the <code>'change'</code> listener:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"doc_write_failures"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"docs_read"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"docs_written"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"errors"</span><span class="err">:</span> <span class="p">[],</span>
  <span class="s2">"last_seq"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"start_time"</span><span class="err">:</span> <span class="s2">"Fri May 16 2014 18:23:12 GMT-0700 (PDT)"</span><span class="p">,</span>
  <span class="s2">"docs"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="s1">'docId'</span><span class="p">,</span>
      <span class="na">_rev</span><span class="p">:</span> <span class="s1">'1-e798a1a7eb4247b399dbfec84ca699d4'</span><span class="p">,</span>
      <span class="na">and</span><span class="p">:</span> <span class="s1">'data'</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></figure>

<p>Example response in the <code>'complete'</code> listener:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"doc_write_failures"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"docs_read"</span><span class="err">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">"docs_written"</span><span class="err">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">"end_time"</span><span class="err">:</span> <span class="s2">"Fri May 16 2014 18:26:00 GMT-0700 (PDT)"</span><span class="p">,</span>
  <span class="s2">"errors"</span><span class="err">:</span> <span class="p">[],</span>
  <span class="s2">"last_seq"</span><span class="err">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"start_time"</span><span class="err">:</span> <span class="s2">"Fri May 16 2014 18:26:00 GMT-0700 (PDT)"</span><span class="p">,</span>
  <span class="s2">"status"</span><span class="err">:</span> <span class="s2">"complete"</span>
<span class="p">}</span></code></pre></figure>

<p>Note that replication is supported for both local and remote 
databases. So you can replicate from local to local or from remote to 
remote.</p>

<p>However, if you replicate from remote to remote, then the changes 
will flow through PouchDB. If you want to trigger a server-initiated 
replication, please use regular ajax to POST to the CouchDB <code>_replicate</code> endpoint, as described <a href="https://wiki.apache.org/couchdb/Replication">in the CouchDB docs</a>.</p>

<h4 id="filtered-replication">Filtered replication</h4>

<p>As with <a href="#changes">changes()</a>, you can filter from the source database using:</p>

<ul>
  <li>an ad-hoc <code>filter</code> function</li>
  <li>an array of <code>doc_ids</code></li>
  <li>a <code>filter</code> function inside of a design document</li>
  <li>a <code>filter</code> function inside of a design document, with <code>query_params</code></li>
  <li>a <code>view</code> function inside of a design document</li>
</ul>

<p>If you are replicating from a remote CouchDB, then the first method 
will run client-side, whereas the last four will filter on the server 
side. Therefore the last four should be preferred, especially if the 
database is large, because you want to send as few documents over the 
wire as possible.</p>

<p>You should also beware trying to use filtered replication to enforce 
security, e.g. to partition a database per user. A better strategy is 
the <a href="https://github.com/nolanlawson/pouchdb-authentication#couchdb-authentication-recipes">“one database per user” method</a>.</p>

<div class="alert alert-warning">


<div class="alert-text">



<p><strong>Deleting filtered docs</strong>: When you use filtered replication, you should avoid using <code>remove()</code>
 to delete documents, because that removes all their fields as well, 
which means they might not pass the filter function anymore, causing the
 deleted revision to not be replicated. Instead, set the <code>doc._deleted</code> flag to <code>true</code> and then use <code>put()</code> or <code>bulkDocs()</code>.</p>



</div></div>

<h4 id="filtering-examples-1">Filtering examples</h4>

<p>In these examples, we’ll work with some mammals. Let’s imagine our docs are:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Kangaroo'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Koala'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">_id</span><span class="p">:</span> <span class="s1">'c'</span><span class="p">,</span> <span class="na">name</span><span class="p">:</span> <span class="s1">'Platypus'</span><span class="p">,</span> <span class="na">type</span><span class="p">:</span> <span class="s1">'monotreme'</span><span class="p">}</span>
<span class="p">]</span></code></pre></figure>

<p>Here are 5 examples using the 5 different systems.</p>

<p><strong>Example 1: Ad-hoc <code>filter</code> function</strong></p>

<p><em>Warning</em>: this runs client-side, if you are replicating from a remote database.</p>

<p>Filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 2: Array of <code>doc_ids</code></strong></p>

<p>Filter documents with <code>_id</code>s <code>['a', 'c']</code>.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">doc_ids</span><span class="p">:</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">]</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 3: <code>filter</code> function inside of a design document</strong></p>

<p>First <code>put()</code> a design document in the remote database:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/mydesign'</span><span class="p">,</span>
  <span class="nx">filters</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myfilter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'mydesign/myfilter'</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 4: <code>filter</code> function inside of a design document, with <code>query_params</code></strong></p>

<p>This is the most powerful way to filter, because it allows you to pass in arbitrary options to your filter function.</p>

<p>First <code>put()</code> a design document in the remote database:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/mydesign'</span><span class="p">,</span>
  <span class="nx">filters</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myfilter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
    <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'mydesign/myfilter'</span><span class="p">,</span>
  <span class="na">query_params</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'marsupial'</span><span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p><strong>Example 5: <code>view</code> function inside of a design document</strong></p>

<p>This doesn’t really offer any advantages compared to the previous two methods, unless you are already using a <code>view</code> for map/reduce queries, and you want to reuse it.</p>

<p>Any documents that <code>emit()</code> anything will be considered to have passed this filter method.</p>

<p>First <code>put()</code> a design document in the remote database:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="nl">_id</span><span class="p">:</span> <span class="s1">'_design/mydesign'</span><span class="p">,</span>
  <span class="nx">views</span><span class="err">:</span> <span class="p">{</span>
    <span class="nl">myview</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">map</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'marsupial'</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Then filter by <code>type === 'marsupial'</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">remote</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">local</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="s1">'_view'</span><span class="p">,</span>
  <span class="na">view</span><span class="p">:</span> <span class="s1">'mydesign/myview'</span>
<span class="p">});</span></code></pre></figure>

<h4 id="customizing-retry-replication">Customizing retry replication</h4>

<p>During <code>retry</code> replication, you can customize the backoff 
function that determines how long to wait before reconnecting when the 
user goes offline.</p>

<p>Here’s a simple backoff function that starts at 1000 milliseconds and triples it every time a remote request fails:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remote</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">retry</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">back_off_function</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">delay</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">delay</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>The first time a request fails, this function will receive 0 as 
input. The next time it fails, 1000 will be passed in, then 3000, then 
9000, etc. When the user comes back online, the <code>delay</code> goes back to 0.</p>

<p>By default, PouchDB uses a backoff function that chooses a random 
starting number between 0 and 2000 milliseconds and will roughly double 
every time, with some randomness to prevent client requests from 
occurring simultaneously.</p>

<div class="h2"><div class="anchor-id" id="sync"></div><a class="anchor" href="#sync" name="sync">Sync a database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/sync.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></figure>

<p>Sync data from <code>src</code> to <code>target</code> and <code>target</code> to <code>src</code>. This is a convenience method for bidirectional data replication.</p>

<p>In other words, this code:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">'mydb'</span><span class="p">,</span> <span class="s1">'http://localhost:5984/mydb'</span><span class="p">);</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">'http://localhost:5984/mydb'</span><span class="p">,</span> <span class="s1">'mydb'</span><span class="p">);</span></code></pre></figure>

<p>is equivalent to this code:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">'mydb'</span><span class="p">,</span> <span class="s1">'http://localhost:5984/mydb'</span><span class="p">);</span></code></pre></figure>

<h3 id="options-6">Options</h3>

<ul>
  <li><code>options.push</code> + <code>options.pull</code>: Allows you to specify separate <a href="https://pouchdb.com/api.html#replication">replication options</a> for the individual replications.</li>
</ul>

<p>Replication options such as <code>filter</code> passed to sync directly will be passed to both replications. Please refer to <a href="https://pouchdb.com/api.html#replication">replicate()</a> for documentation on those options.</p>

<h4 id="example-usage-10">Example Usage:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">'mydb'</span><span class="p">,</span> <span class="s1">'http://localhost:5984/mydb'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">retry</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle change</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'paused'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// replication paused (e.g. replication up to date, user went offline)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'active'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// replicate resumed (e.g. new changes replicating, user went back online)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'denied'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// a document failed to replicate (e.g. due to permissions)</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle complete</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle error</span>
<span class="p">});</span>

<span class="nx">sync</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></figure>

<p>There is also a shorthand for syncing given existing PouchDB objects. This behaves the same as <code>PouchDB.sync()</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></figure>

<p>It is also possible to combine “one-way” replication and sync for 
performance reasons. 
When your PouchDB application starts up it could perform a one-off, 
one-way replication to completion and then initiate the two-way, 
continuous retryable sync:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">'http://localhost:5984/mydb'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span> <span class="na">live</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">retry</span><span class="p">:</span> <span class="kc">true</span> <span class="p">};</span>

<span class="c1">// do one way, one-off sync from the server until completion</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'complete'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// then two-way, continuous, retriable sync</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">onSyncChange</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'paused'</span><span class="p">,</span> <span class="nx">onSyncPaused</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">onSyncError</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">onSyncError</span><span class="p">);;</span></code></pre></figure>

<p>The above technique results in fewer HTTP requests being used and better performance than just using <code>db.sync</code> on its own.</p>

<h4 id="example-response-11">Example Response:</h4>

<p>Change events in <code>sync</code> have an extra property <code>direction</code> which refers to the direction the change was going. Its value will either be <code>push</code> or <code>pull</code>.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="nl">direction</span><span class="p">:</span> <span class="s1">'push'</span><span class="p">,</span>
  <span class="nx">change</span><span class="err">:</span>
   <span class="p">{</span> <span class="nl">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nx">start_time</span><span class="err">:</span> <span class="s1">'2015-10-21T15:26:51.151Z'</span><span class="p">,</span>
     <span class="nx">docs_read</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">docs_written</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">doc_write_failures</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
     <span class="nx">errors</span><span class="err">:</span> <span class="p">[],</span>
     <span class="nx">last_seq</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="nx">docs</span><span class="err">:</span> <span class="p">[</span> <span class="p">[</span><span class="nb">Object</span><span class="p">]</span> <span class="p">]</span> <span class="p">}</span> <span class="p">}</span></code></pre></figure>

<p>For any further details, please refer to <a href="https://pouchdb.com/api.html#replication">replicate()</a>.</p>

<div class="h2"><div class="anchor-id" id="save_attachment"></div><a class="anchor" href="#save_attachment" name="save_attachment">Save an attachment</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/save_attachment.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="p">[</span><span class="nx">rev</span><span class="p">],</span> <span class="nx">attachment</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">]);</span></code></pre></figure>

<p>Attaches a binary object to a document.</p>

<p>This method will update an existing document to add the attachment, so it requires a <code>rev</code>
 if the document already exists. If the document doesn’t already exist, 
then this method will create an empty document containing the 
attachment.</p>

<p>What’s the point of attachments? If you’re dealing with large binary 
data (such as PNGs), you may incur a performance or storage penalty if 
you naïvely include them as base64- or hex-encoded strings inside your 
documents. But if you insert the binary data as an attachment, then 
PouchDB will attempt to store it in <a href="http://pouchdb.com/faq.html#data_types">the most efficient way possible</a>.</p>

<p>For details, see the <a href="https://wiki.apache.org/couchdb/HTTP_Document_API#Attachments">CouchDB documentation on attachments</a>.</p>

<h4 id="example-usage-11">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="attach1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="attach1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="attach1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="attach1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">});</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-12">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"rev"</span><span class="err">:</span> <span class="s2">"2-068E73F5B44FEC987B51354DFC772891"</span>
<span class="p">}</span></code></pre></figure>

<p>Within Node, you must use a <code>Buffer</code> instead of a <code>Blob</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">'Is there life on Mars?'</span><span class="p">);</span></code></pre></figure>

<p>For details, see the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Mozilla docs on <code>Blob</code></a> or the <a href="http://nodejs.org/api/buffer.html">Node docs on <code>Buffer</code></a>.</p>

<p>If you need a shim for older browsers that don’t support the <code>Blob</code> constructor, or you want some convenience methods for Blobs, you can use <a href="https://github.com/nolanlawson/blob-util">blob-util</a>.</p>

<h4 id="save-a-base64-attachment">Save a base64 attachment</h4>

<p>If you supply a string instead of a <code>Blob</code>/<code>Buffer</code>, then it will be assumed to be a base64-encoded string, and will be processed accordingly:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="attach3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="attach3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> 
        <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
        <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="attach3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span>
    <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
    <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="attach3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">attachment</span> <span class="o">=</span> 
        <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
        <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">attachment</span><span class="p">,</span> <span class="s1">'text/plain'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="save-an-inline-attachment">Save an inline attachment</h4>

<p>You can also inline attachments inside the document. The attachment data may be supplied as a base64-encoded string with the <code>content_type</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="attach2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="attach2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
              <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="attach2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
    <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
    <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
          <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="attach2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="s2">"TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKTWFrZS"</span> <span class="o">+</span>
              <span class="s2">"BvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA=="</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="save-an-inline-blobbuffer-attachment">Save an inline Blob/Buffer attachment</h4>

<p>You can also inline <code>Blob</code>s/<code>Buffer</code>s:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="attach4"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="attach4" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="attach4" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
    <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
    <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="attach4" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">'Is there life on Mars?'</span><span class="p">],</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="save-many-attachments-at-once">Save many attachments at once</h4>

<p>The inline approach allows you to save multiple attachments to the same document in a single shot:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="attach5"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="attach5" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"And she's hooked to the silver screen"</span><span class="p">],</span>
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="s2">"att2.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="err">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"But the film is a saddening bore"</span><span class="p">],</span>
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="s2">"att3.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="err">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"For she's lived it ten times or more"</span><span class="p">],</span>
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="attach5" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
    <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
    <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
          <span class="p">[</span><span class="s2">"And she's hooked to the silver screen"</span><span class="p">],</span>
          <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
      <span class="p">},</span>
      <span class="s2">"att2.txt"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
          <span class="p">[</span><span class="s2">"But the film is a saddening bore"</span><span class="p">],</span>
          <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
      <span class="p">},</span>
      <span class="s2">"att3.txt"</span><span class="err">:</span> <span class="p">{</span>
        <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="err">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
          <span class="p">[</span><span class="s2">"For she's lived it ten times or more"</span><span class="p">],</span>
          <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="attach5" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc"</span><span class="p">,</span>
  <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Legendary Hearts"</span><span class="p">,</span>
  <span class="s2">"_attachments"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="p">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"And she's hooked to the silver screen"</span><span class="p">],</span> 
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="s2">"att2.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="err">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"But the film is a saddening bore"</span><span class="p">],</span> 
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">},</span>
    <span class="s2">"att3.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="err">:</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">"For she's lived it ten times or more"</span><span class="p">],</span> 
        <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'text/plain'</span><span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>See <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Inline_Attachments">Inline Attachments</a>
on the CouchDB wiki for details.</p>

<div class="h2"><div class="anchor-id" id="get_attachment"></div><a class="anchor" href="#get_attachment" name="get_attachment">Get an attachment</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/get_attachment.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Get attachment data.</p>

<h3 id="options-7">Options</h3>

<ul>
  <li><code>options.rev</code>: as with <a href="#fetch_document">get()</a>, you can pass a <code>rev</code> in and get back an attachment for the document at that particular revision.</li>
</ul>

<h4 id="example-usage-12">Example Usage:</h4>

<p>Get an attachment with filename <code>'att.txt'</code> from document with ID <code>'doc'</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="get_att1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="get_att1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="get_att1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">blobOrBuffer</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="get_att1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>Get an attachment with filename <code>'att.txt'</code> from document with ID <code>'doc'</code>, at
the revision <code>'1-abcd'</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="get_att2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="get_att2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="p">{</span><span class="na">rev</span><span class="p">:</span> <span class="s1">'1-abcd'</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="get_att2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">blobOrBuffer</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="p">{</span><span class="na">rev</span><span class="p">:</span> <span class="s1">'1-abcd'</span><span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="get_att2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="p">{</span><span class="na">rev</span><span class="p">:</span> <span class="s1">'1-abcd'</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blobOrBuffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="response-type">Response type:</h4>

<p>The response will be a <code>Blob</code> object in the browser, and a <code>Buffer</code> object in Node.js. See <a href="https://github.com/nolanlawson/blob-util">blob-util</a> for utilities to transform <code>Blob</code>s to other formats, such as base64-encoded strings, data URLs, array buffers, etc.</p>

<h4 id="inline-base64-attachments">Inline base64 attachments</h4>

<p>You can specify <code>{attachments: true}</code> to most “read” operations, such as <code>get()</code>, <code>allDocs()</code>, <code>changes()</code>, and <code>query()</code>.
 The attachment data will then be included inlined in the resulting 
doc(s). However, it will always be supplied as base64. For example:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"_attachments"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"digest"</span><span class="err">:</span> <span class="s2">"d5ccfd24a8748bed4e2c9a279a2b6089"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="err">:</span> <span class="s2">"SXMgdGhlcmUgbGlmZSBvbiBNYXJzPw=="</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
  <span class="s2">"_rev"</span><span class="err">:</span> <span class="s2">"1-e147d9ec9c85139dfe7e93bc17148d1a"</span>
<span class="p">}</span></code></pre></figure>

<p>For such APIs, when you don’t specify <code>{attachments: true}</code>, you will instead get metadata about the attachments. For example:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"_attachments"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"att.txt"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"content_type"</span><span class="err">:</span> <span class="s2">"text/plain"</span><span class="p">,</span>
      <span class="s2">"digest"</span><span class="err">:</span> <span class="s2">"d5ccfd24a8748bed4e2c9a279a2b6089"</span><span class="p">,</span>
      <span class="s2">"stub"</span><span class="err">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"mydoc"</span><span class="p">,</span>
  <span class="s2">"_rev"</span><span class="err">:</span> <span class="s2">"1-e147d9ec9c85139dfe7e93bc17148d1a"</span>
<span class="p">}</span></code></pre></figure>

<p>This “summary” operation may be faster in some cases, because the attachment itself does not need to be read from disk.</p>

<div class="h2"><div class="anchor-id" id="delete_attachment"></div><a class="anchor" href="#delete_attachment" name="delete_attachment">Delete an attachment</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/delete_attachment.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Delete an attachment from a doc. You must supply the <code>rev</code> of the existing doc.</p>

<h4 id="example-usage-13">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_att"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_att" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rev</span> <span class="o">=</span> <span class="s1">'1-068E73F5B44FEC987B51354DFC772891'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result                      </span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_att" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">rev</span> <span class="o">=</span> <span class="s1">'1-068E73F5B44FEC987B51354DFC772891'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">rev</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_att" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">rev</span> <span class="o">=</span> <span class="s1">'1-068E73F5B44FEC987B51354DFC772891'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">'doc'</span><span class="p">,</span> <span class="s1">'att.txt'</span><span class="p">,</span> <span class="nx">rev</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-13">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">"rev"</span><span class="err">:</span> <span class="s2">"2-1F983211AB87EFCCC980974DFC27382F"</span>
<span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="create_index"></div><a class="anchor" href="#create_index" name="create_index">Create index</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/create_index.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">(</span><span class="nx">index</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Create an index if it doesn’t exist, or do nothing if it already exists.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>pouchdb-find plugin needed:</strong> This API requires the <code>pouchdb-find</code> plugin. See
<a href="https://pouchdb.com/guides/mango-queries.html">Mango queries</a> for installation instructions.</p>


</div></div>

<h4 id="example-usage-14">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="create_idx"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="create_idx" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="create_idx" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="create_idx" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-14">Example Response:</h4>

<p>If the index was created, you’ll see:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">"result"</span><span class="err">:</span> <span class="s2">"created"</span> <span class="p">}</span></code></pre></figure>

<p>Or if the index already exists:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">"result"</span><span class="err">:</span> <span class="s2">"exists"</span> <span class="p">}</span></code></pre></figure>

<p>You can also create an index on multiple fields:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="create_idx2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="create_idx2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="create_idx2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="create_idx2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>Or an index on deep fields:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="create_idx3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="create_idx3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'person.address.zipcode'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="create_idx3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'person.address.zipcode'</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="create_idx3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'person.address.zipcode'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>You can also specify additional options, if you want more control over how your index is created:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="create_idx4"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="create_idx4" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">],</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'myindex'</span><span class="p">,</span>
    <span class="na">ddoc</span><span class="p">:</span> <span class="s1">'mydesigndoc'</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="create_idx4" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">],</span>
      <span class="na">name</span><span class="p">:</span> <span class="s1">'myindex'</span><span class="p">,</span>
      <span class="na">ddoc</span><span class="p">:</span> <span class="s1">'mydesigndoc'</span>
      <span class="na">type</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="create_idx4" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">createIndex</span><span class="p">({</span>
  <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">],</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'myindex'</span><span class="p">,</span>
    <span class="na">ddoc</span><span class="p">:</span> <span class="s1">'mydesigndoc'</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h3 id="options-8">Options</h3>

<ul>
  <li><code>fields</code>: a list of fields to index</li>
  <li><code>name</code> (optional): name of the index, auto-generated if you don’t include it</li>
  <li><code>ddoc</code> (optional): design document name (i.e. the part after <code>'_design/'</code>), auto-generated if you don’t include it</li>
  <li><code>type</code> (optional): only supports <code>'json'</code>, which is also the default</li>
</ul>

<div class="h2"><div class="anchor-id" id="query_index"></div><a class="anchor" href="#query_index" name="query_index">Query index</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/query_index.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">request</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Query an index and return the list of documents that match the request.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>pouchdb-find plugin needed:</strong> This API requires the <code>pouchdb-find</code> plugin. See
<a href="https://pouchdb.com/guides/mango-queries.html">Mango queries</a> for installation instructions.</p>


</div></div>

<h4 id="example-usage-15">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">},</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">},</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
    <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">},</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-15">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"docs"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"mario"</span><span class="p">,</span>
      <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Mario"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></figure>

<p>The above is a simple example. For an in-depth tutorial, please refer to
<a href="https://pouchdb.com/guides/mango-queries.html">the Mango guide</a>.</p>

<h3 id="options-9">Options</h3>

<ul>
  <li><code>selector</code> Defines a selector to filter the results. Required.
    <ul>
      <li><code>$lt</code> Match fields “less than” this one.</li>
      <li><code>$gt</code> Match fields “greater than” this one.</li>
      <li><code>$lte</code> Match fields “less than or equal to” this one.</li>
      <li><code>$gte</code> Match fields “greater than or equal to” this one.</li>
      <li><code>$eq</code> Match fields equal to this one.</li>
      <li><code>$ne</code> Match fields not equal to this one.</li>
      <li><code>$exists</code> True if the field should exist, false otherwise.</li>
      <li><code>$type</code> One of: “null”, “boolean”, “number”, “string”, “array”, or “object”.</li>
      <li><code>$in</code> Matches if all the selectors in the array match.</li>
      <li><code>$and</code> Matches if all the selectors in the array match.</li>
      <li><code>$nin</code> The document field must not exist in the list provided.</li>
      <li><code>$all</code> Matches an array value if it contains all the elements of the argument array.</li>
      <li><code>$size</code> Special condition to match the length of an array field in a document.</li>
      <li><code>$or</code> Matches if any of the selectors in the array match. All selectors must use the same index.</li>
      <li><code>$nor</code> Matches if none of the selectors in the array match.</li>
      <li><code>$not</code> Matches if the given selector does not match.</li>
      <li><code>$mod</code> Matches documents where (field % Divisor == Remainder) is true, and only when the document field is an integer.</li>
      <li><code>$regex</code> A regular expression pattern to match against the document field.</li>
      <li><code>$elemMatch</code> Matches all documents that contain an array field with at least one element that matches all the specified query criteria.</li>
    </ul>
  </li>
  <li><code>fields</code> (Optional) Defines a list of fields that you want to receive. If omitted, you get the full documents.</li>
  <li><code>sort</code> (Optional) Defines a list of fields defining how you want to sort. Note that sorted fields also have to be selected in the <code>selector</code>.</li>
  <li><code>limit</code> (Optional) Maximum number of documents to return.</li>
  <li><code>skip</code> (Optional) Number of docs to skip before returning.</li>
  <li><code>use_index</code> (Optional) Set which index to use for the query. It can be “design-doc-name” or “[‘design-doc-name’, ‘name’]”.</li>
</ul>

<p>If there’s no index that matches your <code>selector</code>/<code>sort</code>, then this method will issue a warning:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"docs"</span><span class="err">:</span> <span class="p">[</span> <span class="cm">/* ... */</span> <span class="p">],</span>
  <span class="s2">"warning"</span><span class="err">:</span> <span class="s2">"no matching index found, create an index to optimize query time"</span>
<span class="p">}</span></code></pre></figure>

<p>The best index will be chosen automatically. If you want to see the query plan for your query, then turn on debugging:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">'pouchdb:find'</span><span class="p">);</span></code></pre></figure>

<p>See the <a href="http://docs.couchdb.org/en/2.0.0/api/database/find.html">CouchDB <code>_find</code> documentation</a> for more details on
selectors and the Mango query language.</p>

<h3 id="more-examples">More examples</h3>

<p>Use <code>$eq</code> for “equals”:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">$eq</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">$eq</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="p">{</span><span class="na">$eq</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>This is equivalent to:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>You can also do selections on multiple fields. For instance, to
find all docs where <code>series</code> is <code>'Mario'</code> and <code>debut</code> is greater than <code>1990</code>:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx4"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx4" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
    <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx4" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
      <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx4" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
    <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>This is equivalent to:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx5"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx5" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">$and</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx5" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">$and</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span> <span class="p">},</span>
        <span class="p">{</span> <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx5" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">$and</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">series</span><span class="p">:</span> <span class="s1">'Mario'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">debut</span><span class="p">:</span> <span class="p">{</span> <span class="na">$gt</span><span class="p">:</span> <span class="mi">1990</span> <span class="p">}</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>You can also sort the returned documents. For instance, to find all docs sorted by <code>debut</code> descending:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query_idx6"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query_idx6" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">debut</span><span class="p">:</span> <span class="p">{</span><span class="s1">'$gte'</span><span class="p">:</span> <span class="kc">null</span><span class="p">}</span>
  <span class="p">},</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[{</span><span class="na">debut</span><span class="p">:</span> <span class="s1">'desc'</span><span class="p">}]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query_idx6" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">debut</span><span class="p">:</span> <span class="p">{</span><span class="s1">'$gte'</span><span class="p">:</span> <span class="kc">null</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="na">sort</span><span class="p">:</span> <span class="p">[{</span><span class="na">debut</span><span class="p">:</span> <span class="s1">'desc'</span><span class="p">}]</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query_idx6" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">debut</span><span class="p">:</span> <span class="p">{</span><span class="s1">'$gte'</span><span class="p">:</span> <span class="kc">null</span><span class="p">}</span>
  <span class="p">},</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[{</span><span class="na">debut</span><span class="p">:</span> <span class="s1">'desc'</span><span class="p">}]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<div class="h2"><div class="anchor-id" id="explain_index"></div><a class="anchor" href="#explain_index" name="explain_index">Explain index</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/explain_index.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">explain</span><span class="p">(</span><span class="nx">request</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Explain the query plan for a given query</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>pouchdb-find plugin needed:</strong> This API requires the <code>pouchdb-find</code> plugin. See
<a href="https://pouchdb.com/guides/mango-queries.html">Mango queries</a> for installation instructions.</p>


</div></div>

<h4 id="example-usage-16">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="explain_idx"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="explain_idx" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">explain</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
    <span class="na">series</span><span class="p">:</span> <span class="s2">"mario"</span>
  <span class="p">},</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">explanation</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// view explanation</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="explain_idx" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">explanation</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">explain</span><span class="p">({</span>
    <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
      <span class="na">series</span><span class="p">:</span> <span class="s2">"mario"</span>
    <span class="p">},</span>
    <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
    <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="explain_idx" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">explain</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="s1">'Mario'</span><span class="p">,</span>
    <span class="na">series</span><span class="p">:</span> <span class="s2">"mario"</span>
  <span class="p">},</span>
  <span class="na">fields</span><span class="p">:</span> <span class="p">[</span><span class="s1">'_id'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">],</span>
  <span class="na">sort</span><span class="p">:</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">explanation</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// view explanation</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-16">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"dbname"</span><span class="err">:</span> <span class="s2">"database-name"</span>
  <span class="s2">"index"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"ddoc"</span><span class="err">:</span> <span class="s2">"_design/design-doc-name"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="err">:</span> <span class="s2">"index-name"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="err">:</span> <span class="s2">"json"</span><span class="p">,</span>
    <span class="s2">"def"</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"fields"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"asc"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s2">"series"</span><span class="p">:</span> <span class="s2">"asc"</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">"selector"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"$and"</span><span class="err">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"name"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"$eq"</span><span class="p">:</span> <span class="s2">"mario"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">"series"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"$eq"</span><span class="p">:</span> <span class="s2">"mario"</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="s2">"opts"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"use_index"</span><span class="err">:</span> <span class="p">[],</span>
    <span class="s2">"bookmark"</span><span class="err">:</span> <span class="s2">"nil"</span><span class="p">,</span>
    <span class="s2">"limit"</span><span class="err">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s2">"skip"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"sort"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"name"</span><span class="err">:</span> <span class="s2">"asc"</span><span class="p">},</span>
    <span class="s2">"fields"</span><span class="err">:</span> <span class="p">[</span>
      <span class="s2">"_id"</span>
    <span class="p">],</span>
    <span class="s2">"r"</span><span class="err">:</span> <span class="p">[</span>
      <span class="mi">49</span>
    <span class="p">],</span>
    <span class="s2">"conflicts"</span><span class="err">:</span> <span class="kc">false</span>
  <span class="p">},</span>
  <span class="s2">"limit"</span><span class="err">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s2">"skip"</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">"fields"</span><span class="err">:</span> <span class="p">[</span>
    <span class="s2">"_id"</span>
  <span class="p">],</span>
  <span class="s2">"range"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"start_key"</span><span class="err">:</span> <span class="p">[</span>
      <span class="s2">"mario"</span><span class="p">,</span>
      <span class="s2">"mario"</span>
    <span class="p">],</span>
    <span class="s2">"end_key"</span><span class="err">:</span> <span class="p">[</span>
      <span class="s2">"mario"</span><span class="p">,</span>
      <span class="s2">"mario"</span><span class="p">,</span>
      <span class="p">{}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="list_indexes"></div><a class="anchor" href="#list_indexes" name="list_indexes">List indexes</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/list_indexes.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Get a list of all the indexes you’ve created. Also tells you about the
special <code>_all_docs</code> index, i.e. the default index on the <code>_id</code> field.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>pouchdb-find plugin needed:</strong> This API requires the <code>pouchdb-find</code> plugin. See
<a href="https://pouchdb.com/guides/mango-queries.html">Mango queries</a> for installation instructions.</p>


</div></div>

<h4 id="example-usage-17">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="get_idxs"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="get_idxs" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="get_idxs" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="get_idxs" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getIndexes</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-17">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"indexes"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"ddoc"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"_all_docs"</span><span class="p">,</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"special"</span><span class="p">,</span>
      <span class="s2">"def"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"asc"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"ddoc"</span><span class="p">:</span> <span class="s2">"_design/idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
      <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
      <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"json"</span><span class="p">,</span>
      <span class="s2">"def"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"asc"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">"bar"</span><span class="p">:</span> <span class="s2">"asc"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="delete_index"></div><a class="anchor" href="#delete_index" name="delete_index">Delete index</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/delete_index.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">(</span><span class="nx">index</span> <span class="p">[,</span> <span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Delete an index, remove any orphaned design documents, and clean up any leftover data on disk.</p>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>pouchdb-find plugin needed:</strong> This API requires the <code>pouchdb-find</code> plugin. See
<a href="https://pouchdb.com/guides/mango-queries.html">Mango queries</a> for installation instructions.</p>


</div></div>

<h4 id="example-usage-18">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_idx"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_idx" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">({</span>
  <span class="s2">"ddoc"</span><span class="p">:</span> <span class="s2">"_design/idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
  <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"json"</span><span class="p">,</span>
  <span class="s2">"def"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s2">"bar"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_idx" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">({</span>
    <span class="s2">"ddoc"</span><span class="p">:</span> <span class="s2">"_design/idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
    <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"json"</span><span class="p">,</span>
    <span class="s2">"def"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">"bar"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_idx" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">({</span>
  <span class="s2">"ddoc"</span><span class="p">:</span> <span class="s2">"_design/idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"idx-0f3a6f73110868266fa5c688caf8acd3"</span><span class="p">,</span>
  <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"json"</span><span class="p">,</span>
  <span class="s2">"def"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"fields"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="s2">"bar"</span><span class="p">:</span> <span class="s2">"asc"</span> <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-18">Example Response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">"ok"</span><span class="err">:</span> <span class="kc">true</span> <span class="p">}</span></code></pre></figure>

<p>Note that the easiest way to do this is to locate the index you want to delete using <a href="#list_indexes"><code>getIndexes()</code></a>.
For instance, here is how you would delete the second index from that list (which should be the
one after the built-in <code>_all_docs</code> index):</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="delete_idx2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="delete_idx2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">findIndexes</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">indexesResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">(</span><span class="nx">indexesResult</span><span class="p">.</span><span class="nx">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle result</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="delete_idx2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">indexesResult</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">findIndexes</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">(</span><span class="nx">indexesResult</span><span class="p">.</span><span class="nx">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="delete_idx2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">findIndexes</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">indexesResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">deleteIndex</span><span class="p">(</span><span class="nx">indexesResult</span><span class="p">.</span><span class="nx">indexes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p><strong>Notes:</strong></p>

<ul>
  <li>You don’t need to provide a <code>_rev</code> when deleting an index.</li>
  <li>The associated design doc is automatically deleted, assuming it only contains one index.</li>
  <li>There is no need to call <a href="#view_cleanup"><code>viewCleanup</code></a> to clean up any leftover data. <code>deleteIndex()</code> does this automatically for you.</li>
</ul>

<div class="h2"><div class="anchor-id" id="query_database"></div><a class="anchor" href="#query_database" name="query_database">Map/reduce queries</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/query_database.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Invoke a map/reduce function, which allows you to perform more complex queries on PouchDB than what you get with <a href="#batch_fetch">allDocs()</a>, <a href="#changes">changes()</a>, or <a href="#query_index">find()</a>. The <a href="http://docs.couchdb.org/en/latest/couchapp/views/intro.html">CouchDB documentation for map/reduce</a> applies to PouchDB.</p>

<p>Since views perform a full scan of all documents, this method may be 
slow, unless you first save your view in a design document. Read the <a href="https://pouchdb.com/guides/queries.html">query guide</a> for a good tutorial.</p>

<div class="alert alert-warning">


<div class="alert-text">


<p><strong>Warning: advanced API.</strong> The map/reduce API is designed for cases that are too complex for Mango queries, which are described in
<a href="#create_index">createIndex()</a>, <a href="#query_index">find()</a>, <a href="#list_indexes">listIndexes()</a>, and <a href="#delete_index">deleteIndex()</a>.</p>

<p>Under the hood, Mango indexes are the same as map/reduce indexes. The
 Mango API is just a simplified user-facing API on top of map/reduce.</p>


</div></div>

<h3 id="options-10">Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
  <li><code>fun</code>: Map/reduce function, which can be one of the following:
    <ul>
      <li>A full CouchDB-style map/reduce view: <code>{map : ..., reduce: ...}</code>.</li>
      <li>A map function by itself (no reduce).</li>
      <li>The name of a view in an existing design document (e.g. <code>'mydesigndoc/myview'</code>, or <code>'myview'</code> as a shorthand for <code>'myview/myview'</code>).</li>
    </ul>
  </li>
  <li><code>options.reduce</code>: Reduce function, or the string name of a built-in function: <code>'_sum'</code>, <code>'_count'</code>, or <code>'_stats'</code>.  Defaults to <code>false</code> (no reduce).
    <ul>
      <li>Tip: if you’re not using a built-in, <a href="http://youtu.be/BKQ9kXKoHS8?t=865s">you’re probably doing it wrong</a>.</li>
      <li>PouchDB will always call your reduce function with rereduce == false. As for CouchDB, refer to the <a href="http://docs.couchdb.org/en/1.6.1/couchapp/views/intro.html">CouchDB documentation</a>.</li>
    </ul>
  </li>
  <li><code>options.include_docs</code>: Include the document in each row in the <code>doc</code> field.
    <ul>
      <li><code>options.conflicts</code>: Include conflicts in the <code>_conflicts</code> field of a doc.</li>
      <li><code>options.attachments</code>: Include attachment data.
        <ul>
          <li><code>options.binary</code>: Return attachment data as Blobs/Buffers, instead of as base64-encoded strings.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get rows with keys in a certain range (inclusive/inclusive).</li>
  <li><code>options.inclusive_end</code>: Include rows having a key equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
  <li><code>options.limit</code>: Maximum number of rows to return.</li>
  <li><code>options.skip</code>: Number of rows to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
  <li><code>options.descending</code>: Reverse the order of the output rows.</li>
  <li><code>options.key</code>: Only return rows matching this key.</li>
  <li><code>options.keys</code>: Array of keys to fetch in a single shot.
    <ul>
      <li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
      <li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
      <li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>"deleted":true</code> in the <code>value</code> property.</li>
      <li>The row for a nonexistent document will just contain an <code>"error"</code> property with the value <code>"not_found"</code>.</li>
    </ul>
  </li>
  <li><code>options.group</code>: True if you want the reduce function to group results by keys, rather than returning a single result. Defaults to <code>false</code>.</li>
  <li><code>options.group_level</code>: Number of elements in a key to group by, assuming the keys are arrays. Defaults to the full length of the array.</li>
  <li><code>options.stale</code>: One of <code>'ok'</code> or <code>'update_after'</code>.  Only applies to saved views. Can be one of:
    <ul>
      <li>unspecified (default): Returns the latest results, waiting for the view to build if necessary.</li>
      <li><code>'ok'</code>: Returns results immediately, even if they’re out-of-date.</li>
      <li><code>'update_after'</code>: Returns results immediately, but kicks off a build afterwards.</li>
    </ul>
  </li>
</ul>

<p>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</p>

<h4 id="example-usage-19">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// create a design doc</span>
<span class="kd">var</span> <span class="nx">ddoc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">_id</span><span class="p">:</span> <span class="s1">'_design/index'</span><span class="p">,</span>
  <span class="na">views</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">map</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">mapFun</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// save the design doc</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">ddoc</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">name</span> <span class="o">!==</span> <span class="s1">'conflict'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// ignore if doc already exists</span>
  <span class="c1">// find docs where title === 'Lisa Says'</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">key</span><span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
    <span class="c1">// handle result</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// create a design doc</span>
<span class="kd">var</span> <span class="nx">ddoc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">_id</span><span class="p">:</span> <span class="s1">'_design/index'</span><span class="p">,</span>
  <span class="na">views</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">map</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">mapFun</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// save the design doc</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">ddoc</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span> <span class="o">!==</span> <span class="s1">'conflict'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ignore if doc already exists</span>
  <span class="p">}</span>
  <span class="c1">// find docs where title === 'Lisa Says'</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">key</span><span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// create a design doc</span>
<span class="kd">var</span> <span class="nx">ddoc</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">_id</span><span class="p">:</span> <span class="s1">'_design/index'</span><span class="p">,</span>
  <span class="na">views</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">map</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">mapFun</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}.</span><span class="nx">toString</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// save the design doc</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">ddoc</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">name</span> <span class="o">!==</span> <span class="s1">'conflict'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="c1">// ignore if doc already exists</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// find docs where title === 'Lisa Says'</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">key</span><span class="p">:</span> <span class="s1">'Lisa Says'</span><span class="p">,</span>
    <span class="na">include_docs</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">});</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-19">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"offset"</span> <span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"rows"</span><span class="err">:</span> <span class="p">[{</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc3"</span><span class="p">,</span>
    <span class="s2">"key"</span><span class="p">:</span> <span class="s2">"Lisa Says"</span><span class="p">,</span>
    <span class="s2">"value"</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc3"</span><span class="p">,</span>
      <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-z"</span><span class="p">,</span>
      <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"Lisa Says"</span>
    <span class="p">}</span>
  <span class="p">}],</span>
  <span class="s2">"total_rows"</span> <span class="err">:</span> <span class="mi">4</span>
<span class="p">}</span></code></pre></figure>

<p>In the result,<code>total_rows</code> is the total number of possible results in the view. The response is very similar to that of <code>allDocs()</code>.</p>

<p><strong>Note:</strong> you can also pass in the map function instead 
of saving a design doc first, but this is slow because it has to do a 
full database scan. The following examples will use this pattern for 
simplicity’s sake, but you should normally avoid it.</p>

<h4 id="complex-keys">Complex keys</h4>

<p>You can also use <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Complex_Keys">complex keys</a> for fancy ordering:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query2"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query2" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query2" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query2" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-20">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"offset"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"rows"</span><span class="err">:</span> <span class="p">[{</span>
      <span class="s2">"id"</span>  <span class="p">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
      <span class="s2">"key"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"Bowie"</span><span class="p">,</span> <span class="s2">"David"</span><span class="p">,</span> <span class="mi">67</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">"id"</span>  <span class="p">:</span> <span class="s2">"dylan"</span><span class="p">,</span>
      <span class="s2">"key"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"Dylan"</span><span class="p">,</span> <span class="s2">"Bob"</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">"id"</span>  <span class="p">:</span> <span class="s2">"younger_dylan"</span><span class="p">,</span>
      <span class="s2">"key"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"Dylan"</span><span class="p">,</span> <span class="s2">"Jakob"</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">"id"</span>  <span class="p">:</span> <span class="s2">"hank_the_third"</span><span class="p">,</span>
      <span class="s2">"key"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"Williams"</span><span class="p">,</span> <span class="s2">"Hank"</span><span class="p">,</span> <span class="mi">41</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">"id"</span>  <span class="p">:</span> <span class="s2">"hank"</span><span class="p">,</span>
      <span class="s2">"key"</span> <span class="p">:</span> <span class="p">[</span><span class="s2">"Williams"</span><span class="p">,</span> <span class="s2">"Hank"</span><span class="p">,</span> <span class="mi">91</span><span class="p">]</span>
    <span class="p">}],</span>
  <span class="s2">"total_rows"</span><span class="err">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></figure>

<p><strong>Tips:</strong></p>

<ul>
  <li>The sort order is <code>[nulls, booleans, numbers, strings, arrays, objects]</code>, so <code>{startkey: ['Williams'], endkey: ['Williams', {}]}</code> would return all people with the last name <code>'Williams'</code> because objects are higher than strings. Something like <code>'zzzzz'</code> or <code>'\ufff0'</code> would also work.</li>
  <li><code>group_level</code> can be very helpful when working with complex keys.  In the example above, you can use <code>{group_level: 1}</code> to group by last name, or <code>{group_level: 2}</code> to group by last and first name. (Be sure to set <code>{reduce: true, group: true}</code> as well.)</li>
</ul>

<h4 id="linked-documents">Linked documents</h4>

<p>PouchDB fully supports <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Linked_documents">linked documents</a>. Use them to join two types of documents together, by simply adding an <code>_id</code> to the emitted value:</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query3"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query3" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'album'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="na">_id</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="na">albumYear</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="na">include_docs</span> <span class="p">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query3" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'album'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="na">_id</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="na">albumYear</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="na">include_docs</span> <span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query3" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">'album'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="na">_id</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="na">albumYear</span> <span class="p">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="na">include_docs</span> <span class="p">:</span> <span class="kc">true</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-21">Example response:</h4>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">"offset"</span><span class="err">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"rows"</span><span class="err">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-fdb234b78904a5c8293f2acf4be70d44"</span><span class="p">,</span>
                <span class="s2">"age"</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">"firstName"</span><span class="p">:</span> <span class="s2">"David"</span><span class="p">,</span>
                <span class="s2">"lastName"</span><span class="p">:</span> <span class="s2">"Bowie"</span>
            <span class="p">},</span>
            <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"album_hunkeydory"</span><span class="p">,</span>
            <span class="s2">"key"</span><span class="err">:</span> <span class="s2">"Hunky Dory"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"albumYear"</span><span class="err">:</span> <span class="mi">1971</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-fdb234b78904a5c8293f2acf4be70d44"</span><span class="p">,</span>
                <span class="s2">"age"</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">"firstName"</span><span class="p">:</span> <span class="s2">"David"</span><span class="p">,</span>
                <span class="s2">"lastName"</span><span class="p">:</span> <span class="s2">"Bowie"</span>
            <span class="p">},</span>
            <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"album_low"</span><span class="p">,</span>
            <span class="s2">"key"</span><span class="err">:</span> <span class="s2">"Low"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"albumYear"</span><span class="err">:</span> <span class="mi">1977</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"doc"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-fdb234b78904a5c8293f2acf4be70d44"</span><span class="p">,</span>
                <span class="s2">"age"</span><span class="p">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">"firstName"</span><span class="p">:</span> <span class="s2">"David"</span><span class="p">,</span>
                <span class="s2">"lastName"</span><span class="p">:</span> <span class="s2">"Bowie"</span>
            <span class="p">},</span>
            <span class="s2">"id"</span><span class="err">:</span> <span class="s2">"album_spaceoddity"</span><span class="p">,</span>
            <span class="s2">"key"</span><span class="err">:</span> <span class="s2">"Space Oddity"</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="err">:</span> <span class="p">{</span>
                <span class="s2">"_id"</span><span class="err">:</span> <span class="s2">"bowie"</span><span class="p">,</span>
                <span class="s2">"albumYear"</span><span class="err">:</span> <span class="mi">1969</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"total_rows"</span><span class="err">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></figure>

<h4 id="closures">Closures</h4>

<p>If you pass a function to <code>db.query</code> and give it the <code>emit</code> function as the second argument, then you can use a closure. (Since PouchDB has to use <code>eval()</code> to bind <code>emit</code>.)</p>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="query4"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="query4" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// you'll get an error here</span>
<span class="p">});</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="query4" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// you'll get an error here</span>
<span class="p">}</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="query4" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// you'll get an error here</span>
<span class="p">}</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">'foo'</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<p>Note that closures are only supported by local databases with 
temporary views. So if you are using closures, then you must use the 
slower method that requires a full database scan.</p>

<div class="h2"><div class="anchor-id" id="view_cleanup"></div><a class="anchor" href="#view_cleanup" name="view_cleanup">View cleanup</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/view_cleanup.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Cleans up any stale map/reduce indexes.</p>

<p>As design docs are deleted or modified, their associated index files 
(in CouchDB) or companion databases (in local PouchDBs) continue to take
 up space on disk. <code>viewCleanup()</code> removes these unnecessary index files.</p>

<p>See <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html#views-cleanup">the CouchDB documentation on view cleanup</a> for details.</p>

<h4 id="example-usage-20">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="viewcleanup"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="viewcleanup" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="viewcleanup" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="viewcleanup" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-22">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">"ok"</span> <span class="err">:</span> <span class="s2">"true"</span> <span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="database_information"></div><a class="anchor" href="#database_information" name="database_information">Get database information</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/database_information.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Get information about a database.</p>

<h4 id="example-usage-21">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="dbinfo"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="dbinfo" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="dbinfo" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="dbinfo" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-23">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"db_name"</span><span class="err">:</span> <span class="s2">"test"</span><span class="p">,</span>
  <span class="s2">"doc_count"</span><span class="err">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">"update_seq"</span><span class="err">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></figure>

<p><strong>Response object:</strong></p>

<ul>
  <li><code>db_name</code> is the name of the database you gave when you called <code>new PouchDB()</code>, and also the unique identifier for the database.</li>
  <li><code>doc_count</code> is the total number of non-deleted documents in the database.</li>
  <li><code>update_seq</code> is the sequence number of the database.  It starts at 0 and gets incremented every time a document is added or modified.</li>
</ul>

<p>There are also some details you can use for debugging. These are unofficial and may change at any time:</p>

<ul>
  <li><code>adapter</code>: The name of the adapter being used (idb, websql, leveldb, …).</li>
  <li><code>idb_attachment_format</code>: (IndexedDB) either <code>'base64'</code> or <code>'binary'</code>, depending on whether the browser <a href="https://pouchdb.com/faq.html#data_types">supports binary blobs</a>.</li>
  <li><code>sqlite_plugin</code>: (WebSQL) true if the [SQLite Plugin][] is being used.</li>
  <li><code>websql_encoding</code>: (WebSQL) either <code>'UTF-8'</code> or <code>'UTF-16'</code>, depending on the <a href="http://pouchdb.com/faq.html#data_types">WebSQL implementation</a></li>
  <li><code>backend_adapter</code>: (Node.JS) the backend *DOWN adapter being used (MemDOWN, RiakDOWN, …).</li>
</ul>

<div class="h2"><div class="anchor-id" id="compaction"></div><a class="anchor" href="#compaction" name="compaction">Compact the database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/compaction.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Triggers a compaction operation in the local or remote database. This
 reduces the database’s size by removing unused and old data, namely 
non-leaf revisions and attachments that are no longer referenced by 
those revisions. Note that this is a separate operation from <a href="#view_cleanup"><code>viewCleanup()</code></a>.</p>

<p>For remote databases, PouchDB checks the compaction status at regular
 intervals and fires the callback (or resolves the promise) upon 
completion. Consult the <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html">compaction section of CouchDB’s maintenance documentation</a> for more details.</p>

<p>Also see <a href="#create_database">auto-compaction</a>, which runs compaction automatically (local databases only).</p>

<ul>
  <li><code>options.interval</code>: Number of milliseconds to wait 
before asking again if compaction is already done. Defaults to 200. 
(Only applies to remote databases.)</li>
</ul>

<h4 id="example-usage-22">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="compact"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="compact" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="compact" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="compact" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-24">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span> <span class="s2">"ok"</span> <span class="err">:</span> <span class="s2">"true"</span> <span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="revisions_diff"></div><a class="anchor" href="#revisions_diff" name="revisions_diff">Document revisions diff</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/revisions_diff.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Given a set of document/revision IDs, returns the subset of those that do not correspond
to revisions stored in the database. Primarily used in replication.</p>

<h4 id="example-usage-23">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="revsdiff1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="revsdiff1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
  <span class="na">myDoc1</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"1-b2e54331db828310f3c772d6e042ac9c"</span><span class="p">,</span>
    <span class="s2">"2-3a24009a9525bde9e4bfa8a99046b00d"</span>
  <span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="revsdiff1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
    <span class="na">myDoc1</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"1-b2e54331db828310f3c772d6e042ac9c"</span><span class="p">,</span>
      <span class="s2">"2-3a24009a9525bde9e4bfa8a99046b00d"</span>
    <span class="p">]</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="revsdiff1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
  <span class="na">myDoc1</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"1-b2e54331db828310f3c772d6e042ac9c"</span><span class="p">,</span>
    <span class="s2">"2-3a24009a9525bde9e4bfa8a99046b00d"</span>
  <span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-25">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"myDoc1"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"missing"</span><span class="err">:</span> <span class="p">[</span><span class="s2">"2-3a24009a9525bde9e4bfa8a99046b00d"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="bulk_get"></div><a class="anchor" href="#bulk_get" name="bulk_get">Document bulk get</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/bulk_get.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkGet</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Given a set of document/revision IDs, returns the document bodies 
(and, optionally, attachment data) for each ID/revision pair specified.</p>

<h3 id="options-11">Options</h3>

<ul>
  <li><code>options.docs</code>: An array of <code>id</code> and <code>rev</code> pairs representing the revisions to fetch.
    <ul>
      <li><code>id</code>: ID of the document to fetch.</li>
      <li><code>rev</code>: Revision of the document to fetch. If this is not specified, all available revisions are fetched.</li>
      <li><code>atts_since</code>: Optional and supported by the http 
adapter only. Includes attachments only since specified revisions. 
Doesn’t includes attachments for specified revisions.</li>
    </ul>
  </li>
  <li><code>options.revs</code>: Each returned revision body will include its revision history as a <code>_revisions</code> property. Default is <code>false</code>.</li>
  <li><code>options.attachments</code>: Include attachment data in the response. Default is <code>false</code>, resulting in only stubs being returned.</li>
  <li><code>options.binary</code>: Return attachment data as Blobs/Buffers, instead of as base64-encoded strings. Default is <code>false</code>.</li>
</ul>

<h4 id="example-usage-24">Example Usage:</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="bulkget1"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="bulkget1" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkGet</span><span class="p">({</span>
  <span class="na">docs</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"existing-doc"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-b2e54331db828310f3c772d6e042ac9c"</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"foo"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"2-3a24009a9525bde9e4bfa8a99046b00d"</span><span class="p">},</span>
    <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"bar"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-3a24009a9525bde9e4bfa8a99046b00d"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
  <span class="c1">// handle result</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="bulkget1" data-code-type="async" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">try</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">bulkGet</span><span class="p">({</span>
      <span class="na">docs</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-967a00dff5e02add41819138abb3284d"</span><span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-does-not-exist"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-3a24009a9525bde9e4bfa8a99046b00d"</span><span class="p">},</span>
        <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-bad_rev"</span><span class="p">}</span>
      <span class="p">]</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="bulkget1" data-code-type="promise" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkGet</span><span class="p">({</span>
    <span class="na">docs</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-967a00dff5e02add41819138abb3284d"</span><span class="p">},</span>
      <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-does-not-exist"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-3a24009a9525bde9e4bfa8a99046b00d"</span><span class="p">},</span>
      <span class="p">{</span> <span class="na">id</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span> <span class="na">rev</span><span class="p">:</span> <span class="s2">"1-bad_rev"</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle result</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<h4 id="example-response-26">Example Response:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">"results"</span><span class="err">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">"docs"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"ok"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"_id"</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span>
        <span class="s2">"_rev"</span><span class="p">:</span> <span class="s2">"1-967a00dff5e02add41819138abb3284d"</span><span class="p">,</span>
        <span class="s2">"_revisions"</span><span class="p">:</span> <span class="p">{</span>
          <span class="s2">"ids"</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">"967a00dff5e02add41819138abb3284d"</span>
          <span class="p">],</span>
          <span class="s2">"start"</span><span class="p">:</span> <span class="mi">1</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}],</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"docs"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"error"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"not_found"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc-that-does-not-exist"</span><span class="p">,</span>
        <span class="s2">"reason"</span><span class="p">:</span> <span class="s2">"missing"</span><span class="p">,</span>
        <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"undefined"</span>
      <span class="p">}</span>
    <span class="p">}],</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc-that-does-not-exist"</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">"docs"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"error"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"not_found"</span><span class="p">,</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span><span class="p">,</span>
        <span class="s2">"reason"</span><span class="p">:</span> <span class="s2">"missing"</span><span class="p">,</span>
        <span class="s2">"rev"</span><span class="p">:</span> <span class="s2">"1-badrev"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"doc-that-exists"</span>
  <span class="p">}]</span>
<span class="p">}</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="close_database"></div><a class="anchor" href="#close_database" name="close_database">Close a database</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/close_database.html" target="_blank"></a></div>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">([</span><span class="nx">callback</span><span class="p">])</span></code></pre></figure>

<p>Close the database, this closes any open connection to the underlying
 storage and frees memory (event listeners) the database may be using.</p>

<h4 id="example-usage-25">Example Usage</h4>

<p><strong class="hide" data-code-hide="">Callback:</strong></p>

<ul class="nav nav-tabs nav-code" data-code-tablist="close_db"><li><a href="#async">Async functions</a></li><li class="active"><a href="#promise">Promises</a></li><li><a href="#callback">Callbacks</a></li></ul><div class="tab-content"><div class="tab-pane" id="callback" data-code-id="close_db" data-code-type="callback" role="complementary">

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// success</span>
<span class="p">});</span></code></pre></figure>
</div><div class="tab-pane" id="async" data-code-id="close_db" data-code-type="async" role="complementary">


<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span></code></pre></figure>
</div><div class="tab-pane active" id="promise" data-code-id="close_db" data-code-type="promise" role="complementary">


<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// success</span>
<span class="p">});</span></code></pre></figure>
</div></div>

<p><strong class="hide" data-code-hide="">Async:</strong></p>



<p><strong class="hide" data-code-hide="">Promise:</strong></p>



<div class="h2"><div class="anchor-id" id="events"></div><a class="anchor" href="#events" name="events">Events</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/events.html" target="_blank"></a></div>

<p>PouchDB is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>'created'</code> event when a database is created. A <code>'destroyed'</code> event is emitted when a database is destroyed.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'created'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenever a db is created.</span>
<span class="p">});</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'destroyed'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenever a db is destroyed.</span>
<span class="p">});</span></code></pre></figure>

<div class="h2"><div class="anchor-id" id="defaults"></div><a class="anchor" href="#defaults" name="defaults">Default settings</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/defaults.html" target="_blank"></a></div>

<p>If you find yourself using the same constructor options repeatedly,
you can simplify your code with <code>PouchDB.defaults()</code>:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="na">option1</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="na">option2</span><span class="p">:</span> <span class="s1">'value'</span>
<span class="p">});</span></code></pre></figure>

<p>The returned object is a constructor function that works the same as <code>PouchDB</code>, except that whenever you invoke it (e.g. with <code>new</code>), the given options will be passed in by default.</p>

<h4 id="example-usage-26">Example Usage:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">MyMemPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="na">adapter</span><span class="p">:</span> <span class="s1">'memory'</span>
<span class="p">});</span>
<span class="c1">// In-memory PouchDB</span>
<span class="kd">var</span> <span class="nx">myMemPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyMemPouch</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyPrefixedPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="na">prefix</span><span class="p">:</span> <span class="s1">'/path/to/my/db/'</span>
<span class="p">});</span>
<span class="c1">// db will be named '/path/to/my/db/dbname', useful for LevelDB</span>
<span class="kd">var</span> <span class="nx">myPrefixedPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPrefixedPouch</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">HTTPPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="na">prefix</span><span class="p">:</span> <span class="s1">'http://example.org'</span>
<span class="p">});</span>

<span class="c1">// db will be located at 'http://example.org/testdb'</span>
<span class="kd">var</span> <span class="nx">myHttpPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HTTPPouch</span><span class="p">(</span><span class="s1">'dbname'</span><span class="p">);</span></code></pre></figure>

<p>Note the special constructor option <code>prefix</code>, which appends a prefix to the database name
and can be helpful for URL-based or file-based LevelDOWN path names.</p>

<p>All <a href="#create_database">constructor options</a> are supported. Default options can still be overriden individually.</p>

<div class="h2"><div class="anchor-id" id="plugins"></div><a class="anchor" href="#plugins" name="plugins">Plugins</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/plugins.html" target="_blank"></a></div>

<div class="alert alert-info">


<div class="alert-text">


<p><strong>This section covers <em>authoring</em> plugins.</strong> For a list of third-party plugins,
see <a href="https://pouchdb.com/external.html">Plugins</a>, or for a list of first-party plugins that you can
use to customize the PouchDB build, see <a href="https://pouchdb.com/custom.html">Custom Builds</a>.</p>


</div></div>

<p>Writing a plugin is easy! The API is:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="na">methodName</span><span class="p">:</span> <span class="nx">myFunction</span>
<span class="p">});</span></code></pre></figure>

<p>This will add a <code>db.methodName()</code> to all databases, which runs <code>myFunction</code>.It will always be called in context, so that within the function, <code>this</code> refers to the database object.</p>

<p>There is a <a href="https://github.com/pouchdb/plugin-seed">PouchDB Plugin Seed project</a>, which is the fastest way to get started writing, building and testing your very own plugin.</p>

<h4 id="example-usage-27">Example Usage:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="na">sayHello</span> <span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hello!"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'foobar'</span><span class="p">).</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// prints "Hello!"</span></code></pre></figure>

<p>Alternatively, instead of passing in an object to <code>.plugin()</code>, you can pass in
a function that takes the <code>PouchDB</code> object and performs whatever operations
you want on it. You can use this to load multiple plugins, add adapters,
or attach event listeners to the <code>PouchDB</code> object.</p>

<h4 id="example-usage-28">Example Usage:</h4>
<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">PouchDB</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">hello</span> <span class="o">=</span> <span class="s1">'world'</span><span class="p">;</span>
<span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">hello</span><span class="p">);</span> <span class="c1">// prints "world"</span></code></pre></figure>

<p>(Most likely, if you are writing a PouchDB plugin, you will export either the
object-style or the function-style plugin, so that your users can then
attach it to their PouchDB object.)</p>

<h4 id="load-plugins-from-require">Load Plugins from require()</h4>

<p>You can load plugins into PouchDB when you load it via <code>require()</code>.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span> <span class="p">{</span><span class="na">sayHello</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hello!"</span><span class="p">);</span> <span class="p">}};</span>

<span class="kd">var</span> <span class="nx">PouchDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pouchdb'</span><span class="p">).</span><span class="nx">plugin</span><span class="p">(</span><span class="nx">greet</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'foobar'</span><span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// prints "Hello!"</span></code></pre></figure>

<p>You can chain plugins, as well:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">greet</span> <span class="o">=</span> <span class="p">{</span><span class="na">sayHello</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Hello!"</span><span class="p">);</span> <span class="p">}};</span>
<span class="kd">var</span> <span class="nx">manners</span> <span class="o">=</span> <span class="p">{</span><span class="na">thank</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Thank you, "</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span> <span class="p">}};</span>

<span class="kd">var</span> <span class="nx">PouchDB</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'pouchdb'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="nx">greet</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">plugin</span><span class="p">(</span><span class="nx">manners</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">'foobar'</span><span class="p">);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span> <span class="c1">// prints "Hello!"</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">thank</span><span class="p">(</span><span class="s1">'Mom'</span><span class="p">);</span> <span class="c1">// prints "Thank you, Mom"</span></code></pre></figure>

<h4 id="example-plugin-intercept-updates">Example Plugin: Intercept Updates</h4>

<p>A useful feature of plugins is to intercept updates before they are 
stored in PouchDB. In this way, a plugin might validate that the data is
 correct for the application, or even alter documents before they are 
committed to the database.</p>

<p>The best way to intercept all updates to a PouchDB database is to <strong>override the <code>bulkDocs()</code> method</strong>. All changes to PouchDB documents ultimately pass through the <code>bulkDocs()</code> method. For example, a call to <code>put()</code> will become a <code>bulkDocs()</code> call with a “batch” of one document.</p>

<p>Because PouchDB guarantees to plugin authors that all data changes ultimately happen via <code>bulkDocs()</code>, it is the ideal place for an application or plugin to intercept updates.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// Keep a reference to the "upstream" function.</span>
<span class="kd">var</span> <span class="nx">pouchBulkDocs</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">;</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span><span class="na">bulkDocs</span><span class="p">:</span> <span class="nx">validBulkDocs</span><span class="p">});</span>

<span class="kd">function</span> <span class="nx">validBulkDocs</span><span class="p">(</span><span class="nx">body</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">==</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">callback</span> <span class="o">=</span> <span class="nx">options</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">docs</span> <span class="o">=</span> <span class="nx">body</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">docs</span> <span class="o">=</span> <span class="nx">body</span><span class="p">.</span><span class="nx">docs</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// All documents must have a .name field.</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">docs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">docs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">||</span> <span class="s1">'(no _id given)'</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Document is missing .name field: '</span> <span class="o">+</span> <span class="nx">id</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// All documents check out. Pass them to PouchDB.</span>
  <span class="k">return</span> <span class="nx">pouchBulkDocs</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">docs</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>The above plugin would return an error if anything ever attempts to 
store an unnamed document, including documents which change during 
replication.</p>

<p>Note: this is a very, very simple validation example. It does not behave, for example, like the Apache CouchDB <code>validate_doc_update()</code> API.</p>

<div class="h2"><div class="anchor-id" id="debug_mode"></div><a class="anchor" href="#debug_mode" name="debug_mode">Debug mode</a><a data-original-title="Edit this on Github" data-toggle="tooltip" data-placement="top" title="" class="icon-edit" href="https://github.com/pouchdb/pouchdb/edit/master/docs/_includes/api/debug_mode.html" target="_blank"></a></div>

<p>PouchDB uses the <a href="https://www.npmjs.org/package/debug">debug</a> module for fine-grained debug output.</p>

<div class="alert alert-warning">


<div class="alert-text">


<p>This <code>debug()</code> API is currently part of PouchDB core. However, in PouchDB v7.0.0 it will be moved to a separate plugin.</p>


</div></div>

<p>To enable debug mode, just call:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">'*'</span><span class="p">);</span></code></pre></figure>

<p>In your browser console, you should then see something like this:</p>

<p><a href="https://pouchdb.com/static/img/debug_mode.png" target="_blank">
  <img class="img-responsive" src="API%20Reference_files/debug_mode.png" alt="Coloured Log Output">
</a></p>

<p>In Node.js, you can also set a command-line flag:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DEBUG</span><span class="o">=</span>pouchdb:<span class="k">*</span> node myscript.js</code></pre></figure>

<p>You can also enable debugging of specific modules. Currently we only have <code>pouchb:api</code> (API-level calls) and <code>pouchdb:http</code>  (HTTP requests):</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">'pouchdb:api'</span><span class="p">);</span> <span class="c1">// or</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">enable</span><span class="p">(</span><span class="s1">'pouchdb:http'</span><span class="p">);</span></code></pre></figure>

<p>These settings are saved to the browser’s LocalStorage. So to disable them, you must call:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">debug</span><span class="p">.</span><span class="nx">disable</span><span class="p">();</span></code></pre></figure>

<p>Your users won’t see debug output unless you explicitly call <code>PouchDB.debug.enable()</code> within your application code.</p>



        <div>

    </div>

  </div>
</div></div></article>

    </div>

    <div class="band">

      <div class="container">

        <div class="row">

          <div class="col-xs-4 col-md-offset-0 col-md-2">
            <a href="https://twitter.com/pouchdb" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/twitter.svg" alt="PouchDB's Twitter">
            </a>
          </div>

          <div class="col-xs-4 col-md-2">
            <a href="https://github.com/rvagg/node-levelup" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/leveldb.svg" alt="Node Levelup">
            </a>
          </div>

          <div class="col-xs-4 col-md-2">
            <a href="https://github.com/pouchdb/pouchdb" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/github.svg" alt="PouchDB's Github Repo">
            </a>
          </div>

          <div class="col-xs-4 col-md-offset-0 col-md-2">
            <a href="https://travis-ci.org/pouchdb/pouchdb" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/travis.svg" alt="PouchDB's Travis CI">
            </a>
          </div>

          <div class="col-xs-4 col-md-2">
            <a href="http://couchdb.apache.org/" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/couchdb.svg" alt="CouchDB">
            </a>
          </div>
          <div class="col-xs-4 col-md-2">
            <a href="https://saucelabs.com/" target="_blank" rel="noopener noreferrer">
              <img class="icon" src="API%20Reference_files/saucelabs.svg" alt="Saucelabs">
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="band band-inverse">

      <div class="container">

        <div class="row">

          <div class="col-sm-3">
            <h3 class="nav-head">Learn</h3>
            <ul class="nav nav-silent">
              <li><a href="https://pouchdb.com/getting-started.html">Getting Started</a></li>
              <li><a href="https://pouchdb.com/api.html">API Guide</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class="col-sm-3">
            <h3 class="nav-head">Discuss</h3>
            <ul class="nav nav-silent">
              <li><a href="https://groups.google.com/forum/#%21forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://slack.pouchdb.com/">Slack</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class="col-sm-3">
            <h3 class="nav-head">Contribute</h3>
            <ul class="nav nav-silent">
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb">Source</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="API%20Reference_files/jquery.js"></script>
    <script type="text/javascript" src="API%20Reference_files/bootstrap.js"></script>
    <script type="text/javascript" src="API%20Reference_files/code.js"></script>
    <script type="text/javascript" src="API%20Reference_files/stickyfill.js"></script>
    <script type="text/javascript" src="API%20Reference_files/pouchdb.js"></script>
    <script type="text/javascript">
      var $navSidebarWrapper = $('.nav-sidebar-wrapper');
      if ($navSidebarWrapper.length) {
        $navSidebarWrapper.Stickyfill();
      }
      $('[data-toggle="tooltip"]').tooltip();
      function onCached(e) {
        if (applicationCache.status === 1) {
          giveIntro();
        }
      }

      function giveIntro() {
        console.log('%c\n..............................................................................\n.?I...........~+: ............................................................\n.???.........++++.............................................................\n:????+......+++++.............................................................\n.??????+++++++++:.................................H...........D..B............\n...????++++++++...................................H...........D..B............\n...=????++++++.......PPPPP...OOOO...U....U...CCCC.HHHHH...DDDDD..BBBBB........\n...?????+++++++......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n..???????+++++++ ....P. ..P.O....O..U....U.CC.....H...H..D....D..B....B.......\n..?????????????......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n...I??????????~......PPPPP...OOOO...=UUUUU...CCCC.H...H...DDDDD..BBBBB........\n....?????????~.......P.... ...................................................\n.....???????+........P........................................................\n......??????..................................................................\n..............................................................................\n..............................................................................\n..............................................................................', 'color: #4ec084');
        console.log('%c\nPouchDB itself is hosted at PouchDB.com!\nTo get started, try typing:\nvar db = new PouchDB(\'mydb\');', 'color: #4ec084');
      }
      function offerToReload() {
        $('.js-update-notification')
          .removeClass('btn-update-hidden')
          .on('click', function(){
            window.location.reload();
          });
      }
      if (navigator.serviceWorker) {
        navigator.serviceWorker.register('/serviceWorker.js')
          .then(function (registration) {
            registration.addEventListener('updatefound', function () {
              var newWorker = registration.installing;
              registration.installing.addEventListener('statechange', function () {
                if (newWorker.state == 'installed' && navigator.serviceWorker.controller) {
                  offerToReload();
                }
              });
            });
            giveIntro();
          })
          .catch(function(error) {
            console.log('ServiceWorker registration failed: ', error);
          });
      } else if (window.applicationCache) {
        applicationCache.addEventListener('cached', onCached, false);
        applicationCache.addEventListener('noupdate', giveIntro, false);
        applicationCache.addEventListener('updateready', offerToReload, false);
      }
    </script>
    <button type="button" class="js-update-notification btn btn-primary btn-update btn-update-hidden">
      Content updated, reload now? ↻
    </button>
  

</body></html>